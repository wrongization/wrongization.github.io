<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>BUAA 2025数据库大作业 | wrongization</title><meta name="author" content="wrongization"><meta name="copyright" content="wrongization"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="github仓库：wrongization&#x2F;codefuse: BUAA2025数据库大作业 CodeFuse —— 编程学习系统设计文档一、需求分析1.1 需求描述1.1.1 背景调研通过积极调研信息类相关专业学生在编程学习过程中遇到的困境，了解未来职业素养需求，我们发现传统的编程学习平台单向答题 + 低效讨论的模式存在一定弊端。 1.1.2 用户调研通过对信息类专业学生和互联网从业者的问卷调查">
<meta property="og:type" content="article">
<meta property="og:title" content="BUAA 2025数据库大作业">
<meta property="og:url" content="https://wrongization.site/2026/01/10/db.html">
<meta property="og:site_name" content="wrongization">
<meta property="og:description" content="github仓库：wrongization&#x2F;codefuse: BUAA2025数据库大作业 CodeFuse —— 编程学习系统设计文档一、需求分析1.1 需求描述1.1.1 背景调研通过积极调研信息类相关专业学生在编程学习过程中遇到的困境，了解未来职业素养需求，我们发现传统的编程学习平台单向答题 + 低效讨论的模式存在一定弊端。 1.1.2 用户调研通过对信息类专业学生和互联网从业者的问卷调查">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wrongization.site/img/cover/db/db.webp">
<meta property="article:published_time" content="2026-01-10T07:32:36.000Z">
<meta property="article:modified_time" content="2026-01-10T07:44:06.961Z">
<meta property="article:author" content="wrongization">
<meta property="article:tag" content="python">
<meta property="article:tag" content="sql">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wrongization.site/img/cover/db/db.webp"><link rel="shortcut icon" href="/img/logo.webp"><link rel="canonical" href="https://wrongization.site/2026/01/10/db.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/%E5%8D%8E%E6%96%87%E4%B8%AD%E5%AE%8B%7CTitillium%20Web%7CPingFang%20SC%7CHiragino%20Sans%20GB%7CMicrosoft%20JhengHei%7CMicrosoft%20YaHeisans-serif" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":0},
  copy: {
    success: '成功复制~',
    error: '复制内容到了星之彼方',
    noSupport: '不支持的浏览器！'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":100,"languages":{"author":"作者: wrongization","link":"原文连接: ","source":"来源: https://wrongization.site","info":"复制和转载请标明出处。"}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"你切换到了简体中文","cht_to_chs":"你切换到了繁体中文","day_to_night":"永远是深夜有多好。","night_to_day":"地球就是完美的观测特等席。","bgLight":"#7D26CD","bgDark":"#551A8B","position":"bottom-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '💡加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'BUAA 2025数据库大作业',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2026-01-10 15:44:06'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin><link rel="preconnect" href="https://lib.baomitu.com" crossorigin><link rel="preconnect" href="https://pic.imgdb.cn" crossorigin><link rel="stylesheet" href="/css/transpancy.css"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">🍵载入中...</div><!-- 新的精美加载条--><div class="progress-bar"><div class="progress-track"><div class="progress-fill"></div><div class="progress-glow"></div></div><div class="progress-text">正在向夜晚奔去...</div></div></div></div><script>(() => {
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const $progressBar = $loadingBox.querySelector('.progress-bar')
  const $progressFill = $loadingBox.querySelector('.progress-fill')
  const $progressText = $loadingBox.querySelector('.progress-text')
let determinateActivated = false
let currentPct = 0
// 进度模式：'proportional'（按资源完成比例推进）或 'ticker'（按时间匀速推进）
const PROGRESS_MODE = 'ticker'
// 统一节拍：让进度条均匀增长（不超过 MAX_TICK_PCT），真实完成时再跳到 100%
const MAX_TICK_PCT = 98 // 均匀增长的上限，避免未完成时到 100
const TICK_DURATION = 4000 // 从 0 均匀增长到 MAX_TICK_PCT 的目标时长(ms)
let tickerRAF = 0
let tickerStart = 0

  function setProgress(p) {
    const pct = Math.min(100, Math.max(0, p))
    const next = Math.max(currentPct, pct) // 只增不减，避免视觉回退
    if (!determinateActivated) {
      determinateActivated = true
      $progressBar.classList.add('determinate')
      $progressFill.style.animation = '' // stop indeterminate slide
    }
$progressBar.style.setProperty('--progress-pct', next + '%')
// 直接设置内联样式，确保视觉宽度与百分比一致（即使 CSS 尚未更新）
$progressFill.style.width = next + '%'
// 关闭动画与位移，避免出现仅一小段在滑动的视觉错觉
$progressFill.style.animation = 'none'
$progressFill.style.transform = 'none'
    if ($progressText) $progressText.setAttribute('data-percent', next.toFixed(0) + '%')
    currentPct = next
  }

  function stopTicker() {
    if (tickerRAF) {
      cancelAnimationFrame(tickerRAF)
      tickerRAF = 0
    }
  }

function startTicker() {
    stopTicker()
    tickerStart = performance.now()
    const tick = (now) => {
      if ($loadingBox.classList.contains('loaded')) return // 已结束不再推进
      const elapsed = now - tickerStart
      const target = Math.min(MAX_TICK_PCT, (elapsed / TICK_DURATION) * MAX_TICK_PCT)
      setProgress(target)
      tickerRAF = requestAnimationFrame(tick)
    }
    tickerRAF = requestAnimationFrame(tick)
  }

  // 小工具：为 Promise 加超时上限，避免个别资源阻塞
  function withTimeout(promise, ms) {
    let timer
    const timeout = new Promise(resolve => { timer = setTimeout(resolve, ms) })
    return Promise.race([
      promise.finally(() => clearTimeout(timer)),
      timeout
    ])
  }

function calcAssets() {
    // 只跟踪“首屏/非懒加载”的关键图片 + 字体(限时) + DOM 就绪 + (load 限时)
    const allImgs = Array.from(document.images || [])
    const vh = window.innerHeight || 800
    const isNearViewport = img => {
      const rect = img.getBoundingClientRect ? img.getBoundingClientRect() : null
      return rect ? rect.top < vh * 1.2 : true
    }
    const isLazy = img => (
      img.loading === 'lazy' || img.getAttribute('data-src') || img.getAttribute('data-original')
    )
    const trackedImgs = allImgs.filter(img => {
      // 非懒加载直接跟踪；懒加载只跟踪在视口附近的
      if (isLazy(img)) return isNearViewport(img)
      return true
    })

    const trackers = []

    // 图片：逐个计数，并给每张上限 3.5s，避免单张图卡住
    trackedImgs.forEach(img => {
      const p = new Promise(resolve => {
        if (img.complete && img.naturalWidth) return resolve()
        const done = () => resolve()
        const timer = setTimeout(done, 3500)
        img.addEventListener('load', () => { clearTimeout(timer); done() }, { once: true })
        img.addEventListener('error', () => { clearTimeout(timer); done() }, { once: true })
      })
      trackers.push(p)
    })

    // 字体：整体一次，并设置 1.8s 上限
    if (document.fonts && document.fonts.ready) {
      trackers.push(withTimeout(document.fonts.ready.catch(() => {}), 1800))
    }

    // DOM 就绪：尽早推进
    const domReady = new Promise(resolve => {
      if (document.readyState === 'interactive' || document.readyState === 'complete') return resolve()
      document.addEventListener('DOMContentLoaded', () => resolve(), { once: true })
    })
    trackers.push(domReady)

    // window load：作为“保险”，但最多等 2.5s
    const loadCapped = new Promise(resolve => {
      if (document.readyState === 'complete') return resolve()
      const t = setTimeout(resolve, 2500)
      window.addEventListener('load', () => { clearTimeout(t); resolve() }, { once: true })
    })
    trackers.push(loadCapped)

    let finished = 0
    const total = trackers.length || 1
    const onOneDone = () => {
      finished++
      if (PROGRESS_MODE === 'proportional') {
        // 直接按比例更新，保持严格对应
        const pct = (finished / total) * 100
        setProgress(pct)
      }
      if (finished >= total) {
        // 完成：先瞬到上限（如未到），短暂停留后再到 100 并打开
        stopTicker()
        const needPadToCap = currentPct < 100
        if (needPadToCap) setProgress(100)
        const finish = () => { preloader.endLoading() }
        if (needPadToCap) setTimeout(finish, 100)
        else finish()
      }
    }
    trackers.forEach(p => p.then(onOneDone))

    // 兜底：强制结束，避免极端情况下长时间遮挡（到点即刻收起）
    setTimeout(() => {
      if (!$loadingBox.classList.contains('loaded')) {
        stopTicker()
        setProgress(100)
        preloader.endLoading()
      }
    }, 7000)
  }

  const preloader = {
    endLoading: () => {
stopTicker()
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  function start() {
    preloader.initLoading()
    determinateActivated = false
currentPct = 0
    setProgress(0)
    if (PROGRESS_MODE === 'ticker') startTicker()
    requestAnimationFrame(calcAssets)
  }

  start()

  // 可选 PJAX 支持：若站点启用 pjax，重新触发加载条
  // 适配常见 pjax / instant.page / swup 事件，可按需精简
  const pjaxEvents = ['pjax:send','pjax:complete','swup:animationInStart','swup:contentReplaced']
  pjaxEvents.forEach(ev => {
    document.addEventListener(ev, e => {
      if (ev.includes('send') || ev.includes('animationIn')) {
        start()
      } else if (ev.includes('complete') || ev.includes('contentReplaced')) {
        // 重新统计新页面资源
        requestAnimationFrame(calcAssets)
      }
    })
  })
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo.webp" onerror="onerror=null;src='/img/gif404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">类别</div><div class="length-num">30</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-images"></i><span> 图库</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-paint-brush"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/photo/"><i class="fa-fw fas fa-camera"></i><span> 摄影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 推荐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movie/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><!-- 添加 data-effect 以支持顶图特效切换 (sunset | rainy | sunny | sunrise)--><!-- 默认 rainy，可通过主题配置 theme.header_effect_default 覆盖--><header class="post-bg fixed" id="page-header" style="background-image: url('/img/cover/db/db.webp')" data-effect="rainy"><nav id="nav"><span id="blog-info"><a href="/" title="wrongization"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo.webp"/><span class="site-name">wrongization</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-images"></i><span> 图库</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-paint-brush"></i><span> 画廊</span></a></li><li><a class="site-page child" href="/photo/"><i class="fa-fw fas fa-camera"></i><span> 摄影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 推荐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movie/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">BUAA 2025数据库大作业</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">创建</span><time class="post-meta-date-created" datetime="2026-01-10T07:32:36.000Z" title="创建 2026-01-10 15:32:36">2026-01-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新</span><time class="post-meta-date-updated" datetime="2026-01-10T07:44:06.961Z" title="更新 2026-01-10 15:44:06">2026-01-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数统计:</span><span class="word-count">15k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时间:</span><span>54分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="post-series"><h3>数据库-系列：</h3><li><a class="title" href="/2026/01/10/db.html" title="BUAA 2025数据库大作业">BUAA 2025数据库大作业</a></li></div><article class="post-content" id="article-container"><p>github仓库：<a target="_blank" rel="noopener" href="https://github.com/wrongization/codefuse">wrongization/codefuse: BUAA2025数据库大作业</a></p>
<h1 id="CodeFuse-——-编程学习系统设计文档"><a href="#CodeFuse-——-编程学习系统设计文档" class="headerlink" title="CodeFuse —— 编程学习系统设计文档"></a>CodeFuse —— 编程学习系统设计文档</h1><h2 id="一、需求分析"><a href="#一、需求分析" class="headerlink" title="一、需求分析"></a>一、需求分析</h2><h3 id="1-1-需求描述"><a href="#1-1-需求描述" class="headerlink" title="1.1 需求描述"></a>1.1 需求描述</h3><h4 id="1-1-1-背景调研"><a href="#1-1-1-背景调研" class="headerlink" title="1.1.1 背景调研"></a>1.1.1 背景调研</h4><p>通过<strong>积极调研信息类相关专业学生在编程学习过程中遇到的困境</strong>，<strong>了解未来职业素养需求</strong>，我们发现传统的编程学习平台<strong>单向答题 + 低效讨论</strong>的模式存在一定弊端。</p>
<h4 id="1-1-2-用户调研"><a href="#1-1-2-用户调研" class="headerlink" title="1.1.2 用户调研"></a>1.1.2 用户调研</h4><p>通过对信息类专业学生和互联网从业者的问卷调查，我们初步总结需求如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>信息类专业本科生</th>
<th>信息类专业研究生</th>
<th>互联网从业者</th>
</tr>
</thead>
<tbody>
<tr>
<td>问题和讨论能及时得到反馈</td>
<td>能够得到面向就业机试的系统训练</td>
<td>团队协作开发能力</td>
</tr>
<tr>
<td>能有相对独立的思考和作答空间</td>
<td>问题和讨论能及时得到反馈</td>
<td>便捷，轻量，高效的学习工具</td>
</tr>
</tbody>
</table>
</div>
<h4 id="1-1-3-需求总结"><a href="#1-1-3-需求总结" class="headerlink" title="1.1.3 需求总结"></a>1.1.3 需求总结</h4><ol>
<li>系统，专业的训练资源的需求</li>
<li>协作开发和即时讨论的需求</li>
<li>轻量，便捷，容易上手的需求</li>
<li>独立思考作答的需求</li>
<li>其他</li>
</ol>
<h4 id="1-1-4-项目优势"><a href="#1-1-4-项目优势" class="headerlink" title="1.1.4 项目优势"></a>1.1.4 项目优势</h4><p>​    通过上述需求分析可见，当前主流编程学习平台<strong>单向答题 + 低效协作</strong>的模式已经很难满足未来强调团队协作的职业需求。同时，其<strong>低效的反馈模式</strong>也很难帮助初学者解决学习中遇到的困难。</p>
<p>​    我们的 CodeFuse（代码融合） 项目致力于解决上述问题，实现一个协同，开放，轻量化的编程学习系统，使得三类目标用户在多种场景和需求下获得利好：</p>
<ul>
<li>多态学习：支持团队协作和独立尝试两种模式，用户可以选择尝试自己独立解决某问题，也可以选择团队协作解决某问题。</li>
<li>即时反馈：任一用户在解决某问题的时候可以向其他用户请教，也可以将自己的问题，或者对别人问题的回答发布在题目讨论区。</li>
<li>开放社区：任一用户可以向社区贡献题目，发布讨论，也可以向其他用户私信请教或者提供帮助。</li>
<li>模拟训练：任一用户可以参加社区的比赛，以模拟他们需要面对的各类比赛，考试，面试。</li>
</ul>
<h3 id="1-2-数据流图"><a href="#1-2-数据流图" class="headerlink" title="1.2 数据流图"></a>1.2 数据流图</h3><p><strong>(1) 顶层数据流图</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A((用户))</span><br><span class="line">    B((管理员))</span><br><span class="line">    C((CodeFuse社区))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    B --&gt; D[发布比赛]</span><br><span class="line">    D --&gt; C</span><br><span class="line">    B --&gt; E[发布讨论]</span><br><span class="line">    E --&gt; C</span><br><span class="line">    B --&gt; F[参与讨论]</span><br><span class="line">    F --&gt; C</span><br><span class="line">    B --&gt; G[贡献题目]</span><br><span class="line">    G --&gt; C</span><br><span class="line">    </span><br><span class="line">    A --&gt; E</span><br><span class="line">    A --&gt; F</span><br><span class="line">    A --&gt; G</span><br><span class="line">    </span><br><span class="line">    A --&gt; H[参加比赛]</span><br><span class="line">    H --&gt; C</span><br><span class="line">    A --&gt; J[讨论]</span><br><span class="line">    J --&gt; C</span><br><span class="line">    C --&gt; J</span><br><span class="line">    J --&gt; A</span><br></pre></td></tr></table></figure>
<p><strong>(2) 用户登录数据流图</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[用户] --&gt; B[输入账号密码]</span><br><span class="line">    B --&gt; C&#123;验证身份&#125;</span><br><span class="line">    C --&gt;|成功| D[进入系统]</span><br><span class="line">    C --&gt;|失败| E[返回错误信息]</span><br><span class="line">    E --&gt; B</span><br></pre></td></tr></table></figure>
<p><strong>(3) 题目管理数据流图</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[用户] --&gt; B[浏览题目]</span><br><span class="line">    A --&gt; C[搜索题目]</span><br><span class="line">    A --&gt; D[提交代码]</span><br><span class="line">    B --&gt; E[查看题目详情]</span><br><span class="line">    C --&gt; E</span><br><span class="line">    D --&gt; F[代码评测]</span><br><span class="line">    F --&gt; G[返回结果]</span><br><span class="line">    </span><br><span class="line">    H[管理员] --&gt; I[添加题目]</span><br><span class="line">    H --&gt; J[修改题目]</span><br><span class="line">    H --&gt; K[删除题目]</span><br><span class="line">    I --&gt; L[题目数据库]</span><br><span class="line">    J --&gt; L</span><br><span class="line">    K --&gt; L</span><br></pre></td></tr></table></figure>
<p><strong>(4) 比赛管理数据流图</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[管理员] --&gt; B[创建比赛]</span><br><span class="line">    A --&gt; C[管理比赛]</span><br><span class="line">    B --&gt; D[比赛信息]</span><br><span class="line">    C --&gt; D</span><br><span class="line">    </span><br><span class="line">    E[用户] --&gt; F[浏览比赛]</span><br><span class="line">    E --&gt; G[报名比赛]</span><br><span class="line">    E --&gt; H[参加比赛]</span><br><span class="line">    F --&gt; I[比赛列表]</span><br><span class="line">    G --&gt; J[参赛记录]</span><br><span class="line">    H --&gt; K[比赛提交]</span><br></pre></td></tr></table></figure>
<p><strong>(5) 消息系统数据流图</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[用户] --&gt; B[发送消息]</span><br><span class="line">    A --&gt; C[回复消息]</span><br><span class="line">    A --&gt; D[浏览消息]</span><br><span class="line">    B --&gt; E[消息数据库]</span><br><span class="line">    C --&gt; E</span><br><span class="line">    D --&gt; E</span><br><span class="line">    </span><br><span class="line">    F[管理员] --&gt; G[管理消息]</span><br><span class="line">    G --&gt; E</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：消息系统支持两种类型：</p>
<ul>
<li><strong>题目讨论消息（topic）</strong>：用户在题目下发表讨论，通过 message_problem 关联到题目</li>
<li><strong>私信消息（private）</strong>：用户之间的私信，通过 message_recipient 指定接收者</li>
</ul>
<p><strong>(6) 活动日志数据流图</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[用户操作] --&gt; B&#123;操作类型&#125;</span><br><span class="line">    B --&gt;|注册| C[记录用户创建]</span><br><span class="line">    B --&gt;|提交代码| D[记录代码提交]</span><br><span class="line">    B --&gt;|创建题目| E[记录题目创建]</span><br><span class="line">    B --&gt;|修改题目| F[记录题目更新]</span><br><span class="line">    B --&gt;|删除题目| G[记录题目删除]</span><br><span class="line">    </span><br><span class="line">    H[管理员操作] --&gt; I&#123;管理操作&#125;</span><br><span class="line">    I --&gt;|删除用户| J[记录用户删除]</span><br><span class="line">    I --&gt;|删除提交| K[记录提交删除]</span><br><span class="line">    I --&gt;|管理比赛| L[记录比赛操作]</span><br><span class="line">    </span><br><span class="line">    C --&gt; M[活动日志数据库]</span><br><span class="line">    D --&gt; M</span><br><span class="line">    E --&gt; M</span><br><span class="line">    F --&gt; M</span><br><span class="line">    G --&gt; M</span><br><span class="line">    J --&gt; M</span><br><span class="line">    K --&gt; M</span><br><span class="line">    L --&gt; M</span><br><span class="line">    </span><br><span class="line">    M --&gt; N[管理界面展示]</span><br><span class="line">    N --&gt; O[最近活动列表]</span><br></pre></td></tr></table></figure>
<p><strong>说明</strong>：活动日志系统自动记录所有关键操作，包括：</p>
<ul>
<li><strong>用户操作</strong>：注册、提交代码、创建/修改题目等</li>
<li><strong>管理员操作</strong>：删除用户、删除提交记录、管理比赛等</li>
<li><strong>展示用途</strong>：在管理界面的”系统统计”标签中展示最近活动时间线</li>
</ul>
<h3 id="1-3-数据元素表"><a href="#1-3-数据元素表" class="headerlink" title="1.3 数据元素表"></a>1.3 数据元素表</h3><p>共13个数据库表（6个实体表 + 7个联系表）</p>
<p><strong>重要说明</strong>：</p>
<ul>
<li><strong>10种联系关系</strong>：E-R图中包含10种实体间联系关系</li>
<li><strong>7个联系表</strong>：其中7种多对多关系需要独立的联系表实现，3种一对多关系通过外键直接实现</li>
<li><strong>外键实现的联系</strong>（不需要独立联系表）：<ul>
<li>管理题目：problem表的creator_id外键指向user表</li>
<li>管理竞赛：contest表的creator_id外键指向user表</li>
<li>用户活动日志：activity_log表的user_id外键指向user表</li>
</ul>
</li>
<li><strong>联系表实现的联系</strong>（多对多关系）：<ul>
<li>contest_problem（竞赛-题目）</li>
<li>contest_user（竞赛-用户）</li>
<li>message_problem（消息-题目）</li>
<li>message_recipient（消息-接收者）</li>
<li>problem_submission（题目-提交）</li>
<li>user_submission（用户-提交）</li>
<li><strong>friendship（好友关系）</strong>：用户的自引用多对多关系，通过user_id和friend_id两个外键都指向user表</li>
</ul>
</li>
</ul>
<p><strong>其他说明</strong>：</p>
<ul>
<li>用户和管理员通过同一个 user 表存储，使用 role 字段区分角色</li>
<li><strong>消息系统增强</strong>：通过 message_type 字段区分题目讨论（topic）和私信（private）两种类型；<strong>私信仅允许好友之间发送</strong>，系统在创建私信时会验证发送者和接收者之间是否存在accepted状态的好友关系</li>
<li>提交记录与用户的关联通过 user_submission 联系表实现，支持协作提交场景</li>
<li><strong>评测结果作为提交的属性</strong>：judge_results 以 JSON 数组格式存储在 submission 表的 judge_results 字段中，每个测试点的详细运行结果作为数组元素，包括当时的输入数据、期望输出和实际输出，确保历史数据可追溯；敏感字段（输入、期望输出、实际输出）仅对管理员可见，防止测试数据泄露</li>
<li>活动日志表记录系统中所有关键操作，用于审计和活动展示</li>
<li><strong>测试点数据</strong>：采用 JSON 格式存储在 problem 表的 test_cases 字段中，作为题目的组成部分而非独立实体，简化了数据模型并提升了性能</li>
</ul>
<h4 id="实体表（6-个）"><a href="#实体表（6-个）" class="headerlink" title="实体表（6 个）"></a>实体表（6 个）</h4><p><strong>说明</strong>：E-R图中绘制7个实体（包括管理员实体），数据库实现为6个实体表（用户和管理员合并到user表）</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>实体</th>
<th>主键</th>
<th>主要字段</th>
<th>外键 / 说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户 (user)</td>
<td>user_id</td>
<td>username, password, email, school, rating, created_at, role, avatar</td>
<td>role字段区分普通用户(‘user’)和管理员(‘admin’)；avatar存储用户头像URL</td>
</tr>
<tr>
<td>题目 (problem)</td>
<td>problem_id</td>
<td>title, description, input_format, output_format, sample_input, sample_output, time_limit, memory_limit, difficulty, tags, <strong>test_cases (JSON)</strong></td>
<td>creator_id → user(user_id)；<strong>test_cases字段存储测试点数据的JSON数组</strong></td>
</tr>
<tr>
<td>比赛 (contest)</td>
<td>contest_id</td>
<td>title, description, start_time, end_time</td>
<td>creator_id → user(user_id)</td>
</tr>
<tr>
<td>消息 (message)</td>
<td>message_id</td>
<td>title (可选), content, message_type, created_at</td>
<td>creator_id → user(user_id)；<strong>私信类型(message_type=’private’)需验证好友关系</strong></td>
</tr>
<tr>
<td>提交 (submission)</td>
<td>submission_id</td>
<td>code, language, status, exec_time, exec_memory, submitted_at, <strong>judge_results (JSON)</strong></td>
<td>problem_id → problem(problem_id)（保留）；contest_id → contest(contest_id)（可空）；用户与提交通过 user_submission 关联（支持多人提交）；<strong>judge_results字段存储评测结果JSON数组</strong>，记录每个测试点的详细运行结果（包含输入、期望输出、实际输出等历史数据）</td>
</tr>
<tr>
<td>活动日志 (activity_log)</td>
<td>log_id</td>
<td>action_type, entity_type, entity_id, description, created_at</td>
<td>user_id → user(user_id)（可空，支持系统级操作）</td>
</tr>
</tbody>
</table>
</div>
<h5 id="①-用户-user"><a href="#①-用户-user" class="headerlink" title="① 用户 (user)"></a>① 用户 (user)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>否</td>
<td>用户ID</td>
</tr>
<tr>
<td>username</td>
<td>varchar</td>
<td>255</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>用户名</td>
</tr>
<tr>
<td>password</td>
<td>varchar</td>
<td>255</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>密码（哈希存储）</td>
</tr>
<tr>
<td>email</td>
<td>varchar</td>
<td>255</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>邮箱</td>
</tr>
<tr>
<td>school</td>
<td>varchar</td>
<td>255</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td>学校</td>
</tr>
<tr>
<td>rating</td>
<td>int</td>
<td>11</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>评分</td>
</tr>
<tr>
<td>created_at</td>
<td>datetime</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>创建时间</td>
</tr>
<tr>
<td>role</td>
<td>varchar</td>
<td>50</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>角色（’user’/‘admin’）</td>
</tr>
<tr>
<td>avatar</td>
<td>varchar</td>
<td>255</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td>用户头像URL（存储路径：/uploads/avatars/user_{user_id}.{ext}）</td>
</tr>
</tbody>
</table>
</div>
<p><strong>说明</strong>：</p>
<ul>
<li>用户表通过 role 字段区分普通用户和管理员，ER图中单独绘制管理员实体是为了清晰表达管理关系，实际数据库实现中用户和管理员存储在同一张表中</li>
<li>avatar 字段存储用户头像的相对URL路径，支持普通用户和管理员上传自定义头像，前端通过 API baseURL + avatar 路径访问头像文件</li>
</ul>
<h5 id="②-题目-problem"><a href="#②-题目-problem" class="headerlink" title="② 题目 (problem)"></a>② 题目 (problem)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>problem_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>否</td>
<td>题目ID</td>
</tr>
<tr>
<td>title</td>
<td>varchar</td>
<td>255</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>题目标题</td>
</tr>
<tr>
<td>description</td>
<td>text</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>题目描述</td>
</tr>
<tr>
<td>input_format</td>
<td>text</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>输入格式</td>
</tr>
<tr>
<td>output_format</td>
<td>text</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>输出格式</td>
</tr>
<tr>
<td>sample_input</td>
<td>text</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>样例输入</td>
</tr>
<tr>
<td>sample_output</td>
<td>text</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>样例输出</td>
</tr>
<tr>
<td>time_limit</td>
<td>int</td>
<td>11</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>时间限制(ms)</td>
</tr>
<tr>
<td>memory_limit</td>
<td>int</td>
<td>11</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>内存限制(KB)</td>
</tr>
<tr>
<td>difficulty</td>
<td>varchar</td>
<td>50</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>难度</td>
</tr>
<tr>
<td>tags</td>
<td>varchar</td>
<td>255</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td>标签</td>
</tr>
<tr>
<td>test_cases</td>
<td>JSON</td>
<td>-</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td>测试点数据（JSON数组）</td>
</tr>
<tr>
<td>visible</td>
<td>boolean</td>
<td>1</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>可见性（True=公开，False=不可见）</td>
</tr>
<tr>
<td>creator_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>否</td>
<td>是</td>
<td>创建者ID</td>
</tr>
</tbody>
</table>
</div>
<p><strong>测试点数据结构说明</strong>：</p>
<ul>
<li><code>test_cases</code> 字段采用 JSON 格式存储，为一个数组，每个元素包含：<ul>
<li><code>input_data</code>：测试输入数据（字符串）</li>
<li><code>output_data</code>：期望输出数据（字符串）</li>
<li><code>score</code>：该测试点分值（整数，默认10分）</li>
<li><code>is_sample</code>：是否为样例（0=隐藏测试点，1=公开样例）</li>
<li><code>order</code>：测试点顺序（整数）</li>
</ul>
</li>
<li><strong>设计理由</strong>：测试点是题目的组成部分而非独立实体，使用 JSON 存储简化了数据模型，避免了额外的表和联表查询，提升了性能和可维护性</li>
</ul>
<p><strong>题目可见性和ID管理系统</strong>：</p>
<ul>
<li><code>visible</code> 字段：布尔类型，用于控制题目创建时的ID分配策略</li>
<li><strong>ID分配策略</strong>：<ul>
<li><strong>公开题目</strong>（visible=True）：ID从10000开始自动递增，数据库AUTO_INCREMENT=10000</li>
<li><strong>比赛专用题目</strong>（visible=False）：ID使用1-9999的保留范围，手动分配最小未使用ID</li>
</ul>
</li>
<li><strong>核心机制</strong>：<ul>
<li>创建题目时，通过<code>visible</code>字段决定ID分配方式</li>
<li>ID&lt;10000的题目专用于比赛，不会在公开题库中显示给普通用户</li>
<li>比赛结束后，通过发布接口将题目迁移到公开区（ID&gt;=10000）</li>
<li>迁移后删除旧题目，释放保留ID供下次比赛重用</li>
</ul>
</li>
<li><strong>权限控制</strong>：<ul>
<li>管理员：可以查看和管理所有题目（包括ID&lt;10000的比赛题目）</li>
<li>普通用户：只能查看visible=True的题目（比赛中的题目除外）</li>
</ul>
</li>
<li><strong>使用场景</strong>：<ul>
<li>创建比赛时，设置题目为visible=False，获得保留ID（1-9999）</li>
<li>比赛进行中，参赛者可以做题，但题目不在公开题库显示</li>
<li>比赛结束后，调用发布接口将题目永久发布到公开题库（ID变更为&gt;=10000）</li>
<li>原保留ID被释放，可供下次比赛创建新题使用</li>
</ul>
</li>
<li><strong>发布机制</strong>：通过 <code>POST /contests/&#123;contest_id&#125;/publish_invisible_problems</code> 接口实现<ul>
<li>比赛结束后，管理员手动触发（或可配置自动触发）</li>
<li>查找比赛中所有 ID&lt;10000 的不可见题目</li>
<li>创建新题目（visible=True，自动获得 ID&gt;=10000）</li>
<li>复制所有题目数据，添加 <code>contest-&#123;contest_id&#125;</code> 标签标识来源</li>
<li>更新所有相关提交记录的 problem_id 到新ID</li>
<li>更新比赛题目关联表指向新题目</li>
<li>删除原题目，释放保留ID（1-9999）供后续比赛重用</li>
</ul>
</li>
<li><strong>ID迁移说明</strong>：MySQL主键不可直接修改，通过”创建新题+迁移数据+删除旧题”实现ID变更，保证数据完整性</li>
</ul>
<h5 id="③-比赛-contest"><a href="#③-比赛-contest" class="headerlink" title="③ 比赛 (contest)"></a>③ 比赛 (contest)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>contest_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>否</td>
<td>比赛ID</td>
</tr>
<tr>
<td>title</td>
<td>varchar</td>
<td>255</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>比赛标题</td>
</tr>
<tr>
<td>description</td>
<td>text</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>比赛描述</td>
</tr>
<tr>
<td>start_time</td>
<td>datetime</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>开始时间</td>
</tr>
<tr>
<td>end_time</td>
<td>datetime</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>结束时间</td>
</tr>
<tr>
<td>creator_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>否</td>
<td>是</td>
<td>创建者ID</td>
</tr>
</tbody>
</table>
</div>
<h5 id="④-消息-message"><a href="#④-消息-message" class="headerlink" title="④ 消息 (message)"></a>④ 消息 (message)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>message_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>否</td>
<td>消息ID</td>
</tr>
<tr>
<td>title</td>
<td>varchar</td>
<td>255</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td>标题（可选，主要用于话题贴）</td>
</tr>
<tr>
<td>content</td>
<td>text</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>消息内容</td>
</tr>
<tr>
<td>creator_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>否</td>
<td>是</td>
<td>创建者ID</td>
</tr>
<tr>
<td>message_type</td>
<td>varchar</td>
<td>50</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>消息类型：’topic’ 或 ‘private’</td>
</tr>
<tr>
<td>created_at</td>
<td>datetime</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>创建时间</td>
</tr>
</tbody>
</table>
</div>
<p>说明：消息可能属于题目讨论（topic）或为用户之间的私信（private）。因此不在消息表中直接存储题目或接收者，而是使用下述联系表进行关联（支持多接收者场景）。</p>
<h5 id="⑤-提交-submission"><a href="#⑤-提交-submission" class="headerlink" title="⑤ 提交 (submission)"></a>⑤ 提交 (submission)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>submission_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>否</td>
<td>提交ID</td>
</tr>
<tr>
<td>problem_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>否</td>
<td>是</td>
<td>题目ID</td>
</tr>
<tr>
<td>contest_id</td>
<td>int</td>
<td>20</td>
<td>否</td>
<td>否</td>
<td>是</td>
<td>比赛ID</td>
</tr>
<tr>
<td>code</td>
<td>text</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>代码内容</td>
</tr>
<tr>
<td>language</td>
<td>varchar</td>
<td>50</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>编程语言</td>
</tr>
<tr>
<td>status</td>
<td>varchar</td>
<td>50</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>评测状态</td>
</tr>
<tr>
<td>exec_time</td>
<td>int</td>
<td>11</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>执行时间(ms)</td>
</tr>
<tr>
<td>exec_memory</td>
<td>int</td>
<td>11</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>内存使用(KB)</td>
</tr>
<tr>
<td>submitted_at</td>
<td>datetime</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>提交时间</td>
</tr>
</tbody>
</table>
</div>
<p><strong>说明</strong>：</p>
<ul>
<li>提交表不直接包含 user_id 字段，用户与提交的关联通过 user_submission 联系表实现，这样设计支持多个用户协作完成一个提交的场景（如团队作业、配对编程等）</li>
<li><strong>评测结果作为JSON属性</strong>：judge_results 字段采用 JSON 数组格式存储，每个数组元素代表一个测试点的详细评测结果，包含测试点索引、运行状态、时间、内存、分数等信息</li>
<li><strong>运行结果历史保存</strong>：judge_results 数组中每个元素保存提交时测试点的输入数据(input_data)、期望输出(expected_output)和实际输出(actual_output)，确保即使题目测试点后续修改，也能追溯历史提交的评测详情</li>
<li><strong>权限控制</strong>：测试点的输入、期望输出、实际输出等敏感信息仅对管理员可见，普通用户只能查看运行状态、时间、内存等基本信息，防止测试数据泄露</li>
<li><strong>JSON格式示例</strong>：<code>[&#123;&quot;test_case_index&quot;:0,&quot;status&quot;:&quot;accepted&quot;,&quot;time_used&quot;:12,&quot;memory_used&quot;:14000,&quot;score&quot;:50,&quot;input_data&quot;:&quot;[2,7,11,15]\\n9&quot;,&quot;expected_output&quot;:&quot;[0,1]&quot;,&quot;actual_output&quot;:&quot;[0,1]&quot;,&quot;error_message&quot;:null&#125;,...]</code></li>
</ul>
<h5 id="⑥-活动日志-activity-log"><a href="#⑥-活动日志-activity-log" class="headerlink" title="⑥ 活动日志 (activity_log)"></a>⑥ 活动日志 (activity_log)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>log_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>否</td>
<td>日志ID</td>
</tr>
<tr>
<td>user_id</td>
<td>int</td>
<td>20</td>
<td>否</td>
<td>否</td>
<td>是</td>
<td>执行操作的用户ID</td>
</tr>
<tr>
<td>action_type</td>
<td>varchar</td>
<td>50</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>操作类型（create/update/delete/submit）</td>
</tr>
<tr>
<td>entity_type</td>
<td>varchar</td>
<td>50</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>实体类型（user/problem/contest/submission）</td>
</tr>
<tr>
<td>entity_id</td>
<td>int</td>
<td>20</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td>被操作实体的ID</td>
</tr>
<tr>
<td>description</td>
<td>text</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>操作描述</td>
</tr>
<tr>
<td>created_at</td>
<td>datetime</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>创建时间</td>
</tr>
</tbody>
</table>
</div>
<p><strong>说明</strong>：活动日志表记录系统中所有关键操作，包括用户注册、题目创建/修改/删除、比赛管理、代码提交等，用于系统审计和管理界面的”最近活动”展示。user_id 可为空以支持系统级操作记录。</p>
<h4 id="联系表（7-个）"><a href="#联系表（7-个）" class="headerlink" title="联系表（7 个）"></a>联系表（7 个）</h4><div class="table-container">
<table>
<thead>
<tr>
<th>联系表</th>
<th>主键 / 复合主键</th>
<th>外键</th>
</tr>
</thead>
<tbody>
<tr>
<td>比赛-题目 (contest_problem)</td>
<td>(contest_id, problem_id)</td>
<td>contest_id → contest(contest_id)，problem_id → problem(problem_id)</td>
</tr>
<tr>
<td>比赛-用户 (contest_user)</td>
<td>(contest_id, user_id)</td>
<td>contest_id → contest(contest_id)，user_id → user(user_id)</td>
</tr>
<tr>
<td>消息-题目 (message_problem)</td>
<td>(message_id, problem_id)</td>
<td>message_id → message(message_id)，problem_id → problem(problem_id)</td>
</tr>
<tr>
<td>消息-接收者 (message_recipient)</td>
<td>(message_id, recipient_user_id)</td>
<td>message_id → message(message_id)，recipient_user_id → user(user_id)</td>
</tr>
<tr>
<td>题目-提交 (problem_submission)</td>
<td>(problem_id, submission_id)</td>
<td>problem_id → problem(problem_id)，submission_id → submission(submission_id)</td>
</tr>
<tr>
<td>用户-提交 (user_submission)</td>
<td>(user_id, submission_id)</td>
<td>user_id → user(user_id)，submission_id → submission(submission_id)</td>
</tr>
<tr>
<td>好友关系 (friendship)</td>
<td>friendship_id</td>
<td>user_id → user(user_id)，friend_id → user(user_id)</td>
</tr>
</tbody>
</table>
</div>
<h5 id="①-比赛-题目-contest-problem"><a href="#①-比赛-题目-contest-problem" class="headerlink" title="① 比赛-题目 (contest_problem)"></a>① 比赛-题目 (contest_problem)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>contest_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>比赛ID</td>
</tr>
<tr>
<td>problem_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>题目ID</td>
</tr>
</tbody>
</table>
</div>
<h5 id="②-比赛-用户-contest-user"><a href="#②-比赛-用户-contest-user" class="headerlink" title="② 比赛-用户 (contest_user)"></a>② 比赛-用户 (contest_user)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>contest_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>比赛ID</td>
</tr>
<tr>
<td>user_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>用户ID</td>
</tr>
</tbody>
</table>
</div>
<h5 id="③-消息-题目-message-problem"><a href="#③-消息-题目-message-problem" class="headerlink" title="③ 消息-题目 (message_problem)"></a>③ 消息-题目 (message_problem)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>message_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>消息ID</td>
</tr>
<tr>
<td>problem_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>题目ID</td>
</tr>
</tbody>
</table>
</div>
<p><strong>说明</strong>：用于关联 message_type=’topic’ 的消息到具体题目，实现题目讨论功能。</p>
<h5 id="④-消息-接收者-message-recipient"><a href="#④-消息-接收者-message-recipient" class="headerlink" title="④ 消息-接收者 (message_recipient)"></a>④ 消息-接收者 (message_recipient)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>message_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>消息ID</td>
</tr>
<tr>
<td>recipient_user_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>接收者用户ID</td>
</tr>
</tbody>
</table>
</div>
<p><strong>说明</strong>：用于指定消息的接收者，支持一对一私信和一对多群发消息。对于 message_type=’private’ 的消息，通过此表指定接收用户。</p>
<h5 id="⑤-题目-提交-problem-submission"><a href="#⑤-题目-提交-problem-submission" class="headerlink" title="⑤ 题目-提交 (problem_submission)"></a>⑤ 题目-提交 (problem_submission)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>problem_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>题目ID</td>
</tr>
<tr>
<td>submission_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>提交ID</td>
</tr>
</tbody>
</table>
</div>
<p><strong>使用说明</strong>：</p>
<ul>
<li>提交创建时同步写入 problem_submission，避免多对多查询落空。</li>
<li>管理端“题目管理”提供“题目提交”筛选，按 problem_id 读取 problem_submission 获取所有用户提交。</li>
<li>兼容历史数据：若某题在 problem_submission 中无记录，查询会回退扫描 submission 表并自动补齐映射，下一次不再回退。</li>
</ul>
<h5 id="⑥-用户-提交-user-submission"><a href="#⑥-用户-提交-user-submission" class="headerlink" title="⑥ 用户-提交 (user_submission)"></a>⑥ 用户-提交 (user_submission)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>用户ID</td>
</tr>
<tr>
<td>submission_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>提交ID</td>
</tr>
</tbody>
</table>
</div>
<h5 id="⑦-好友关系-friendship"><a href="#⑦-好友关系-friendship" class="headerlink" title="⑦ 好友关系 (friendship)"></a>⑦ 好友关系 (friendship)</h5><div class="table-container">
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>字段大小</th>
<th>必填字段</th>
<th>主键</th>
<th>外键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>friendship_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>是</td>
<td>否</td>
<td>好友关系ID（主键）</td>
</tr>
<tr>
<td>user_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>否</td>
<td>是</td>
<td>发起用户ID</td>
</tr>
<tr>
<td>friend_id</td>
<td>int</td>
<td>20</td>
<td>是</td>
<td>否</td>
<td>是</td>
<td>目标用户ID</td>
</tr>
<tr>
<td>status</td>
<td>varchar</td>
<td>20</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>关系状态</td>
</tr>
<tr>
<td>created_at</td>
<td>datetime</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>创建时间</td>
</tr>
<tr>
<td>updated_at</td>
<td>datetime</td>
<td>-</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>更新时间</td>
</tr>
</tbody>
</table>
</div>
<p><strong>说明</strong>：</p>
<ul>
<li><strong>关系类型</strong>：用户与用户之间的自反M:N关系（User-User Self-Referential M:N Relationship）</li>
<li><strong>关系状态</strong>：支持四种状态<ul>
<li><code>pending</code> - 待处理（好友请求已发送，等待对方确认）</li>
<li><code>accepted</code> - 已接受（双方成为好友）</li>
<li><code>rejected</code> - 已拒绝（对方拒绝了好友请求）</li>
<li><code>blocked</code> - 已屏蔽（用户屏蔽了对方）</li>
</ul>
</li>
<li><strong>业务规则</strong>：<ul>
<li>一个用户可以向多个用户发送好友请求</li>
<li>一个用户可以收到多个好友请求</li>
<li>只有状态为 <code>accepted</code> 的好友关系才能发送私信</li>
<li>user_id 和 friend_id 的组合必须唯一（防止重复请求）</li>
</ul>
</li>
<li><strong>双向关系</strong>：friendship 表记录单向关系，双方互为好友需要查询双向记录</li>
</ul>
<h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><h2 id="二、数据库概念模式设计"><a href="#二、数据库概念模式设计" class="headerlink" title="二、数据库概念模式设计"></a>二、数据库概念模式设计</h2><h3 id="1-系统初步E-R图"><a href="#1-系统初步E-R图" class="headerlink" title="1. 系统初步E-R图"></a>1. 系统初步E-R图</h3><p><strong>(1) 实体E-R图</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2026/01/10/db/%E5%AE%9E%E4%BD%93.png" class="">
<p><strong>实体及属性说明（E-R图中7个实体，数据库实现为6个实体表）：</strong></p>
<ol>
<li><p><strong>用户 (user)</strong>：系统的基本用户实体</p>
<ul>
<li>属性：用户ID(主键)、用户名、密码、邮箱、学校、评分、创建时间、角色、头像URL</li>
<li><strong>角色字段</strong>：role字段区分普通用户(‘user’)和管理员(‘admin’)</li>
<li><strong>头像字段</strong>：avatar字段存储用户上传的头像URL路径，支持自定义头像，默认显示默认头像图标</li>
</ul>
</li>
<li><p><strong>管理员 (admin)</strong>：系统管理员实体</p>
<ul>
<li>属性：管理员ID(主键)、用户名、密码、邮箱、学校、评分、创建时间、头像URL</li>
<li><strong>重要说明</strong>：E-R图中单独绘制管理员实体是为了清晰表达管理关系，但在数据库实现中，用户和管理员存储在同一个user表中，通过role字段区分（’user’/‘admin’），管理员同样支持自定义头像功能</li>
</ul>
</li>
<li><p><strong>题目 (problem)</strong>：编程题目实体</p>
<ul>
<li>属性：题目ID(主键)、标题、描述、输入格式、输出格式、样例输入、样例输出、时间限制、内存限制、难度、标签、<strong>测试点数据(JSON)</strong>、创建者ID(外键)</li>
<li><strong>测试点数据</strong>：test_cases字段以JSON数组格式存储，每个测试点包含：<ul>
<li><code>input_data</code>：测试输入数据（字符串）</li>
<li><code>output_data</code>：期望输出数据（字符串）</li>
<li><code>score</code>：该测试点分值（整数，默认10分）</li>
<li><code>is_sample</code>：是否为样例（0=隐藏测试点，1=公开样例）</li>
<li><code>order</code>：测试点顺序（整数）</li>
</ul>
</li>
<li><strong>设计说明</strong>：测试点作为题目的固有属性，而非独立实体。采用JSON存储避免了额外的test_case表和相关外键关联，简化了数据模型，提升了查询性能</li>
</ul>
</li>
<li><p><strong>竞赛 (contest)</strong>：编程竞赛实体</p>
<ul>
<li>属性：竞赛ID(主键)、标题、描述、开始时间、结束时间、创建者ID(外键)</li>
</ul>
</li>
<li><p><strong>消息 (message)</strong>：消息实体</p>
<ul>
<li>属性：消息ID(主键)、标题(可选)、内容、创建者ID(外键)、消息类型、创建时间</li>
<li><strong>消息类型</strong>：支持题目讨论消息(‘topic’)和私信消息(‘private’)两种类型</li>
<li>通过联系表实现与题目和接收者的关联</li>
</ul>
</li>
<li><p><strong>提交记录 (submission)</strong>：代码提交实体</p>
<ul>
<li>属性：提交ID(主键)、题目ID(外键)、竞赛ID(外键，可空)、代码、编程语言、状态、执行时间、执行内存、提交时间</li>
<li><strong>用户关联</strong>：不直接包含用户ID字段，通过user_submission联系表关联，支持协作提交场景</li>
</ul>
</li>
<li><p><strong>活动日志 (activity_log)</strong>：系统活动记录实体</p>
<ul>
<li>属性：日志ID(主键)、用户ID(外键，可空)、操作类型、实体类型、实体ID、操作描述、创建时间</li>
<li><strong>操作类型</strong>：create、update、delete、submit等</li>
<li><strong>实体类型</strong>：user、problem、contest、submission等</li>
<li><strong>用途</strong>：记录所有关键操作（用户注册、题目创建/修改/删除、比赛管理、代码提交等），用于系统审计和管理界面的”最近活动”展示</li>
</ul>
</li>
</ol>
<p><strong>(2) 联系E-R图</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2026/01/10/db/%E8%81%94%E7%B3%BB.png" class="" title="联系.drawio">
<p><strong>实体间联系说明（共9种联系关系）：</strong></p>
<ol>
<li><p><strong>管理题目</strong>：管理员(1) - 管理题目 - 题目(N)</p>
<ul>
<li>一个管理员可以管理多个题目</li>
<li>一个题目由一个管理员管理</li>
<li><strong>实现方式</strong>：problem表的creator_id外键指向user表（不需要独立联系表）</li>
</ul>
</li>
<li><p><strong>管理竞赛</strong>：管理员(1) - 管理竞赛 - 竞赛(N)</p>
<ul>
<li>一个管理员可以管理多个竞赛</li>
<li>一个竞赛由一个管理员管理</li>
<li><strong>实现方式</strong>：contest表的creator_id外键指向user表（不需要独立联系表）</li>
</ul>
</li>
<li><p><strong>竞赛题目</strong>：竞赛(M) - 竞赛题目 - 题目(N)</p>
<ul>
<li>一个竞赛可以包含多个题目</li>
<li>一个题目可以属于多个竞赛</li>
<li>多对多关系，通过 contest_problem 联系表实现</li>
</ul>
</li>
<li><p><strong>竞赛用户</strong>：竞赛(M) - 竞赛用户 - 用户(N)</p>
<ul>
<li>一个竞赛可以有多个用户参与</li>
<li>一个用户可以参与多个竞赛</li>
<li>多对多关系，通过 contest_user 联系表实现</li>
</ul>
</li>
<li><p><strong>用户提交</strong>：用户(1) - 用户提交 - 提交记录(N)</p>
<ul>
<li>一个用户可以有多个提交记录</li>
<li>一个提交记录可以关联多个用户（协作提交场景）</li>
<li>通过 user_submission 联系表实现多对多关系</li>
</ul>
</li>
<li><p><strong>题目提交</strong>：题目(1) - 题目提交 - 提交记录(N)</p>
<ul>
<li>一个题目可以有多个提交记录</li>
<li>一个提交记录对应一个题目</li>
<li>通过 problem_submission 联系表实现</li>
</ul>
</li>
<li><p><strong>消息接收者</strong>：用户(1) - 消息接收者 - 消息(N)</p>
<ul>
<li>一个用户可以接收多条消息</li>
<li>一条消息可以发送给多个接收者（群发场景）</li>
<li>多对多关系，通过 message_recipient 联系表实现</li>
</ul>
</li>
<li><p><strong>题目消息</strong>：题目(1) - 题目消息 - 消息(N)</p>
<ul>
<li>一个题目可以有多条讨论消息</li>
<li>一条消息可以关联到一个题目（题目讨论场景）</li>
<li>通过 message_problem 联系表实现</li>
</ul>
</li>
<li><p><strong>用户活动日志</strong>：用户(1) - 记录 - 活动日志(N)</p>
<ul>
<li>一个用户可以产生多条活动日志</li>
<li>一条活动日志属于一个用户（user_id 可为空，支持系统级操作）</li>
<li><strong>实现方式</strong>：activity_log表的user_id外键指向user表（不需要独立联系表）</li>
</ul>
</li>
<li><p><strong>好友关系</strong>：用户(M) - 好友关系 - 用户(N)</p>
<ul>
<li>一个用户可以有多个好友</li>
<li>好友关系是用户之间的双向对等关系（用户的自引用多对多关系）</li>
<li><strong>实现方式</strong>：friendship表通过user_id和friend_id两个外键都指向user表，通过status字段管理好友状态</li>
<li><strong>业务约束</strong>：只有status=’accepted’的好友之间才能发送私信(message_type=’private’)，防止骚扰和垃圾信息</li>
</ul>
</li>
</ol>
<h3 id="2-系统基本E-R图"><a href="#2-系统基本E-R图" class="headerlink" title="2. 系统基本E-R图"></a>2. 系统基本E-R图</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2026/01/10/db/%E5%9F%BA%E6%9C%AC.png" class="">
<p><strong>系统E-R图综合说明：</strong></p>
<p>该图整合了所有实体及其属性，以及实体间的联系关系。核心设计特点：</p>
<ul>
<li><strong>实体设计</strong>：E-R图中绘制7个实体（用户、管理员、题目、竞赛、消息、提交记录、活动日志），数据库实现为6个实体表（用户和管理员合并到user表，通过role字段区分）</li>
<li><strong>10种联系关系</strong>：涵盖管理、参与、提交、消息、活动记录、好友关系等业务场景</li>
<li><strong>数据库表结构</strong>：共13个表 = 6个实体表 + 7个联系表<ul>
<li>3种一对多关系通过外键实现（管理题目、管理竞赛、用户活动日志）</li>
<li>7种多对多关系通过联系表实现（contest_problem、contest_user、message_problem、message_recipient、problem_submission、user_submission、friendship）</li>
</ul>
</li>
<li><strong>评测结果作为JSON属性</strong>：judge_results 以 JSON 数组格式存储在 submission 表中，每个测试点的详细评测结果作为数组元素</li>
<li><strong>消息双重类型</strong>：支持题目讨论（message_problem）和私信（message_recipient）两种场景</li>
<li><strong>协作提交支持</strong>：通过 user_submission 支持多用户共同提交的场景</li>
<li><strong>活动日志审计</strong>：通过 activity_log 记录所有关键操作（user_id外键，可空），支持系统审计和活动展示</li>
<li><strong>好友关系</strong>：通过 friendship 联系表实现用户之间的自引用多对多关系，支持好友请求、接受、拒绝、屏蔽等状态管理</li>
</ul>
<h2 id="三、数据库逻辑模式设计"><a href="#三、数据库逻辑模式设计" class="headerlink" title="三、数据库逻辑模式设计"></a>三、数据库逻辑模式设计</h2><h3 id="1-数据库关系模式"><a href="#1-数据库关系模式" class="headerlink" title="1. 数据库关系模式"></a>1. 数据库关系模式</h3><p>关系模式的形式化表示为 R(U, D, DOM, F)。U 为组成该关系的属性名，D 为 U 中属性所来自的域，DOM 指的是属性与域的映射，F 指的是属性间的依赖关系集合。以下约定 N 表示正整数，FLOAT 表示浮点数，L 为任意字符组成的字符串，T 表示时间，B 表示布尔值。码以下划线标识。</p>
<p><strong>(1) 实体</strong></p>
<p>① 用户 (user)&lt;用户ID，用户名，密码，邮箱，学校，评分，创建时间，角色；D，DOM，F&gt;</p>
<p>其中 D={L, N, T}，DOM={DOM(用户ID)=N, DOM(用户名)=DOM(密码)=DOM(邮箱)=DOM(学校)=DOM(角色)=L, DOM(评分)=N, DOM(创建时间)=T}，F={用户ID→用户名，用户ID→密码，用户ID→邮箱，用户ID→学校，用户ID→评分，用户ID→创建时间，用户ID→角色}。</p>
<p><strong>主码</strong>：（用户ID）</p>
<p>② 题目 (problem)&lt;题目ID，标题，描述，输入格式，输出格式，样例输入，样例输出，时间限制，内存限制，难度，标签，测试点数据(JSON)，创建者ID；D，DOM，F&gt;</p>
<p>其中 D={L, N, JSON}，DOM={DOM(题目ID)=N, DOM(标题)=DOM(描述)=DOM(输入格式)=DOM(输出格式)=DOM(样例输入)=DOM(样例输出)=DOM(难度)=DOM(标签)=L, DOM(时间限制)=DOM(内存限制)=DOM(创建者ID)=N, DOM(测试点数据)=JSON}，F={题目ID→标题，题目ID→描述，题目ID→输入格式，题目ID→输出格式，题目ID→样例输入，题目ID→样例输出，题目ID→时间限制，题目ID→内存限制，题目ID→难度，题目ID→标签，题目ID→测试点数据，题目ID→创建者ID}。</p>
<p><strong>主码</strong>：（题目ID）</p>
<p><strong>外码</strong>：创建者ID，对应用户(user)的码</p>
<p>③ 比赛 (contest)&lt;比赛ID，标题，描述，开始时间，结束时间，创建者ID；D，DOM，F&gt;</p>
<p>其中 D={L, N, T}，DOM={DOM(比赛ID)=N, DOM(标题)=DOM(描述)=L, DOM(开始时间)=DOM(结束时间)=T, DOM(创建者ID)=N}，F={比赛ID→标题，比赛ID→描述，比赛ID→开始时间，比赛ID→结束时间，比赛ID→创建者ID}。</p>
<p><strong>主码</strong>：（比赛ID）</p>
<p><strong>外码</strong>：创建者ID，对应用户(user)的码</p>
<p>④ 消息 (message)&lt;消息ID，标题，内容，创建者ID，消息类型，创建时间；D，DOM，F&gt;</p>
<p>其中 D={L, N, T}，DOM={DOM(消息ID)=N, DOM(标题)=DOM(内容)=L, DOM(创建者ID)=N, DOM(消息类型)=L, DOM(创建时间)=T}，F={消息ID→标题，消息ID→内容，消息ID→创建者ID，消息ID→消息类型，消息ID→创建时间}。</p>
<p><strong>主码</strong>：（消息ID）</p>
<p><strong>外码</strong>：创建者ID，对应用户(user)的码</p>
<p>⑤ 提交记录 (submission)&lt;提交ID，题目ID，比赛ID，代码，语言，状态，执行时间，内存使用，提交时间；D，DOM，F&gt;</p>
<p>其中 D={L, N, T}，DOM={DOM(提交ID)=N, DOM(题目ID)=DOM(比赛ID)=DOM(执行时间)=DOM(内存使用)=N, DOM(代码)=DOM(语言)=DOM(状态)=L, DOM(提交时间)=T}，F={提交ID→题目ID，提交ID→比赛ID，提交ID→代码，提交ID→语言，提交ID→状态，提交ID→执行时间，提交ID→内存使用，提交ID→提交时间}。</p>
<p><strong>主码</strong>：（提交ID）</p>
<p><strong>外码</strong>：题目ID，对应题目(problem)的码；比赛ID，对应比赛(contest)的码（可空）</p>
<p>⑥ 活动日志 (activity_log)&lt;日志ID，用户ID，操作类型，实体类型，实体ID，操作描述，创建时间；D，DOM，F&gt;</p>
<p>其中 D={L, N, T}，DOM={DOM(日志ID)=N, DOM(用户ID)=DOM(实体ID)=N, DOM(操作类型)=DOM(实体类型)=DOM(操作描述)=L, DOM(创建时间)=T}，F={日志ID→用户ID，日志ID→操作类型，日志ID→实体类型，日志ID→实体ID，日志ID→操作描述，日志ID→创建时间}。</p>
<p><strong>主码</strong>：（日志ID）</p>
<p><strong>外码</strong>：用户ID，对应用户(user)的码（可空，支持系统级操作）</p>
<p><strong>(2) 联系</strong></p>
<p>以下联系的关系模式的码是全码，约定省略依赖关系 F 中的主属性对码的完全函数依赖。并且每个主属性都是外码，其域 D 和映射 DOM 都在其对应的关系模式中定义，也可以省略 D 和 DOM。</p>
<p>① 比赛-题目 (contest_problem)&lt;{比赛ID, 题目ID}, D, DOM, F&gt;</p>
<p><strong>外码</strong>：比赛ID，对应比赛(contest)的码；题目ID，对应题目(problem)的码。</p>
<p>② 比赛-用户 (contest_user)&lt;{比赛ID, 用户ID}, D, DOM, F&gt;</p>
<p><strong>外码</strong>：比赛ID，对应比赛(contest)的码；用户ID，对应用户(user)的码。</p>
<p>③ 消息-题目 (message_problem)&lt;{消息ID, 题目ID}, D, DOM, F&gt;</p>
<p><strong>外码</strong>：消息ID，对应消息(message)的码；题目ID，对应题目(problem)的码。</p>
<p>④ 消息-接收者 (message_recipient)&lt;{消息ID, 接收者用户ID}, D, DOM, F&gt;</p>
<p><strong>外码</strong>：消息ID，对应消息(message)的码；接收者用户ID，对应用户(user)的码。</p>
<p>⑤ 题目-提交 (problem_submission)&lt;{题目ID, 提交ID}, D, DOM, F&gt;<br>F={提交ID→题目ID}。</p>
<p><strong>外码</strong>：题目ID，对应题目(problem)的码；提交ID，对应提交记录(submission)的码。</p>
<p>⑥ 用户-提交 (user_submission)&lt;{用户ID, 提交ID}, D, DOM, F&gt;</p>
<p><strong>外码</strong>：用户ID，对应用户(user)的码；提交ID，对应提交记录(submission)的码。</p>
<p>⑦ 好友关系 (friendship)&lt;好友关系ID，用户ID，好友ID，状态，创建时间，更新时间；D，DOM，F&gt;</p>
<p>其中 D={L, N, T}，DOM={DOM(好友关系ID)=N, DOM(用户ID)=DOM(好友ID)=N, DOM(状态)=L, DOM(创建时间)=DOM(更新时间)=T}，F={好友关系ID→用户ID，好友关系ID→好友ID，好友关系ID→状态，好友关系ID→创建时间，好友关系ID→更新时间}。</p>
<p><strong>主码</strong>：（好友关系ID）</p>
<p><strong>外码</strong>：用户ID，对应用户(user)的码；好友ID，对应用户(user)的码</p>
<p><strong>说明</strong>：friendship 表示用户与用户之间的自引用多对多关系（User-User Self-Referential M:N）。状态字段支持 pending（待处理）、accepted（已接受）、rejected（已拒绝）、blocked（已屏蔽）四种值。业务规则要求只有状态为 accepted 的好友之间才能发送私信。</p>
<h3 id="2-关系模式范式等级的判定与规范化"><a href="#2-关系模式范式等级的判定与规范化" class="headerlink" title="2. 关系模式范式等级的判定与规范化"></a>2. 关系模式范式等级的判定与规范化</h3><p>注：要规范到 3NF</p>
<p><strong>(1) 实体</strong></p>
<p>① 用户 (user)（用户ID，用户名，密码，邮箱，学校，评分，创建时间，角色）<br>主码/候选码：用户ID<br>函数依赖：用户ID→（用户名，密码，邮箱，学校，评分，创建时间，角色）<br>每个非主属性对码既没有传递函数依赖，也没有部分函数依赖，故符合 3NF。同时，主属性仅一个，且函数依赖的左部没有非主属性，故不存在主属性对码的部分和传递函数依赖，符合 BCNF。</p>
<p>② 题目 (problem)（题目ID，标题，描述，输入格式，输出格式，样例输入，样例输出，时间限制，内存限制，难度，标签，测试点数据，创建者ID）<br>主码/候选码：题目ID<br>函数依赖：题目ID→（标题，描述，输入格式，输出格式，样例输入，样例输出，时间限制，内存限制，难度，标签，测试点数据，创建者ID）<br>说明：测试点数据以JSON格式存储，作为题目的固有属性而非独立实体。每个非主属性对码既没有传递函数依赖，也没有部分函数依赖，故符合 3NF。同时，主属性仅一个，且函数依赖的左部没有非主属性，故不存在主属性对码的部分和传递函数依赖，符合 BCNF。</p>
<p>③ 比赛 (contest)（比赛ID，标题，描述，开始时间，结束时间，创建者ID）<br>主码/候选码：比赛ID<br>函数依赖：比赛ID→（标题，描述，开始时间，结束时间，创建者ID）<br>每个非主属性对码既没有传递函数依赖，也没有部分函数依赖，故符合 3NF。同时，主属性仅一个，且函数依赖的左部没有非主属性，故不存在主属性对码的部分和传递函数依赖，符合 BCNF。</p>
<p>④ 消息 (message)（消息ID，标题，内容，创建者ID，消息类型，创建时间）<br>主码/候选码：消息ID<br>函数依赖：消息ID→（标题，内容，创建者ID，消息类型，创建时间）<br>每个非主属性对码既没有传递函数依赖，也没有部分函数依赖，故符合 3NF。消息的题目关联和接收者通过关联表（message_problem、message_recipient）建模，从而避免在消息表中混合存储不同类型的目标信息，利于规范化。</p>
<p>⑤ 提交记录 (submission)（提交ID，题目ID，比赛ID，代码，语言，状态，执行时间，内存使用，提交时间）<br>主码/候选码：提交ID<br>函数依赖：提交ID→（题目ID，比赛ID，代码，语言，状态，执行时间，内存使用，提交时间）<br>说明：提交的用户不再作为 submission 的单一属性保存，而是通过 <code>user_submission</code> 联系表建立多对多关系，从而支持一条提交对应多名用户（例如小组提交或多人修改记录）。因此 submission 本身仅保存与提交直接相关的属性，符合 3NF。</p>
<p>⑥ 活动日志 (activity_log)（日志ID，用户ID，操作类型，实体类型，实体ID，操作描述，创建时间）<br>主码/候选码：日志ID<br>函数依赖：日志ID→（用户ID，操作类型，实体类型，实体ID，操作描述，创建时间）<br>每个非主属性对码既没有传递函数依赖，也没有部分函数依赖，故符合 3NF。同时，主属性仅一个，且函数依赖的左部没有非主属性，故不存在主属性对码的部分和传递函数依赖，符合 BCNF。用户ID可为空以支持系统级操作记录。</p>
<p><strong>(2) 联系</strong></p>
<p>对于以下联系，由于都是全码，故没有非主属性，所以一定没有非主属性对码的传递和部分函数依赖，符合 3NF，下不再证明。</p>
<p>约定省略主属性对码的完全函数依赖。</p>
<p>① 比赛-题目 (contest_problem)（比赛ID，题目ID）<br>候选码/主码：（比赛ID，题目ID）<br>由上知是 3NF，同时，不存在主属性对码的部分函数依赖和传递函数依赖，故是 BCNF。</p>
<p>② 比赛-用户 (contest_user)（比赛ID，用户ID）<br>候选码/主码：（比赛ID，用户ID）<br>由上知是 3NF，同时，不存在主属性对码的部分函数依赖和传递函数依赖，故是 BCNF。</p>
<p>③ 消息-题目 (message_problem)（消息ID，题目ID）<br>候选码/主码：（消息ID，题目ID）<br>说明：该联系表为纯联结表，没有非主属性，故符合 3NF；如果业务保证每条消息最多关联一个题目，可在该表上对 message_id 加唯一约束。</p>
<p>④ 消息-接收者 (message_recipient)（消息ID，接收者用户ID）<br>候选码/主码：（消息ID，接收者用户ID）<br>说明：该联系表为纯联结表，没有非主属性，故符合 3NF；用于表示私信的接收方或消息的多个参与者。</p>
<p>⑤ 题目-提交 (problem_submission)（题目ID，提交ID）<br>候选码/主码：（题目ID，提交ID）<br>依赖关系：提交ID→题目ID<br>由上知是 3NF，但存在主属性对码的部分函数依赖，故不是 BCNF。</p>
<p>⑥ 用户-提交 (user_submission)（用户ID，提交ID）<br>候选码/主码：（用户ID，提交ID）<br>依赖关系：提交ID→用户ID<br>由上知是 3NF，但存在主属性对码的部分函数依赖，故不是 BCNF。</p>
<p>⑦ 好友关系 (friendship)（好友关系ID，用户ID，好友ID，状态，创建时间，更新时间）<br>主码/候选码：好友关系ID<br>函数依赖：好友关系ID→（用户ID，好友ID，状态，创建时间，更新时间）<br>每个非主属性对码既没有传递函数依赖，也没有部分函数依赖，故符合 3NF。同时，主属性仅一个，且函数依赖的左部没有非主属性，故不存在主属性对码的部分和传递函数依赖，符合 BCNF。<br>说明：friendship_id 为自增主键，user_id 和 friend_id 的组合应设置唯一约束以防止重复好友关系。</p>
<h3 id="3-数据库设计优化"><a href="#3-数据库设计优化" class="headerlink" title="3. 数据库设计优化"></a>3. 数据库设计优化</h3><p><strong>(1) 增加索引信息</strong></p>
<p>对于实体表，在其唯一的主属性（主码）上增加 UNIQUE 索引信息，加快查表过程。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX user_id <span class="keyword">ON</span> <span class="keyword">user</span>(user_id);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX problem_id <span class="keyword">ON</span> problem(problem_id);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX contest_id <span class="keyword">ON</span> contest(contest_id);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX message_id <span class="keyword">ON</span> message(message_id);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX submission_id <span class="keyword">ON</span> submission(submission_id);</span><br></pre></td></tr></table></figure>
<p>对于联系表，在其主属性（主码）上增加索引信息，加快查表过程。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 比赛-题目 (contest_problem)</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX cp <span class="keyword">ON</span> contest_problem(contest_id, problem_id);</span><br><span class="line"><span class="comment">-- 比赛-用户 (contest_user)</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX cu <span class="keyword">ON</span> contest_user(contest_id, user_id);</span><br><span class="line"><span class="comment">-- 消息-题目 (message_problem)</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX mp <span class="keyword">ON</span> message_problem(message_id, problem_id);</span><br><span class="line"><span class="comment">-- 消息-接收者 (message_recipient)</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX mr <span class="keyword">ON</span> message_recipient(message_id, recipient_user_id);</span><br><span class="line"><span class="comment">-- 题目-提交 (problem_submission)</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX ps <span class="keyword">ON</span> problem_submission(problem_id, submission_id);</span><br><span class="line"><span class="comment">-- 用户-提交 (user_submission)</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX us <span class="keyword">ON</span> user_submission(user_id, submission_id);</span><br><span class="line"><span class="comment">-- 好友关系 (friendship)</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX friendship_id <span class="keyword">ON</span> friendship(friendship_id);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX friendship_unique <span class="keyword">ON</span> friendship(user_id, friend_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX friendship_user <span class="keyword">ON</span> friendship(user_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX friendship_friend <span class="keyword">ON</span> friendship(friend_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX friendship_status <span class="keyword">ON</span> friendship(status);</span><br></pre></td></tr></table></figure>
<p>对于常用查询字段，增加辅助索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX user_username <span class="keyword">ON</span> <span class="keyword">user</span>(username);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX user_email <span class="keyword">ON</span> <span class="keyword">user</span>(email);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX problem_difficulty <span class="keyword">ON</span> problem(difficulty);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX problem_tags <span class="keyword">ON</span> problem(tags);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX problem_creator <span class="keyword">ON</span> problem(creator_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX contest_creator <span class="keyword">ON</span> contest(creator_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX message_creator <span class="keyword">ON</span> message(creator_id);</span><br><span class="line"><span class="comment">-- 注意：submission 不再包含 user_id 字段，用户与提交的关系迁移到 user_submission 表上</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX submission_problem_status <span class="keyword">ON</span> submission(problem_id, status);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX submission_contest <span class="keyword">ON</span> submission(contest_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX message_created_at <span class="keyword">ON</span> message(created_at);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX submission_submitted_at <span class="keyword">ON</span> submission(submitted_at);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX activity_log_user <span class="keyword">ON</span> activity_log(user_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX activity_log_created <span class="keyword">ON</span> activity_log(created_at);</span><br></pre></td></tr></table></figure>
<p><strong>JSON字段说明</strong>：</p>
<ul>
<li>problem表的test_cases字段存储JSON数组，MySQL 5.7+原生支持JSON类型</li>
<li>JSON字段不建议直接建索引，通过problem_id主键查询后在应用层处理</li>
<li>如需按测试点属性查询，可考虑使用MySQL的JSON虚拟列功能</li>
</ul>
<p><strong>(2) 增加外键</strong></p>
<p>保证参照完整性和数据的一致性，所有联系的属性都增加外键。</p>
<p>同时设置在外表的外键删除时，会随着外键改动，同时删除本表中外键对应的关系。</p>
<p>实体表外键约束：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 题目表 (problem)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> problem <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY problem_creator_fk (creator_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> <span class="keyword">user</span> (user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 比赛表 (contest)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> contest <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY contest_creator_fk (creator_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> <span class="keyword">user</span> (user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 消息表 (message)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> message <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY message_creator_fk (creator_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> <span class="keyword">user</span> (user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交表 (submission)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> submission <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY submission_problem_fk (problem_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> problem (problem_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> submission <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY submission_contest_fk (contest_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> contest (contest_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 活动日志表 (activity_log)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> activity_log <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY al_user_fk (user_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> <span class="keyword">user</span> (user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p>联系表外键约束：</p>
<p>比赛-题目 (contest_problem) 外键示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> contest_problem <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY cp_contest_fk (contest_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> contest (contest_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> contest_problem <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY cp_problem_fk (problem_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> problem (problem_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br></pre></td></tr></table></figure>
<p>用户-提交 (user_submission) 外键示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_submission <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY us_user_fk (user_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> <span class="keyword">user</span> (user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_submission <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY us_submission_fk (submission_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> submission (submission_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br></pre></td></tr></table></figure>
<p>消息相关联系外键示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 消息-题目 (message_problem)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> message_problem <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY mp_message_fk (message_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> message (message_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> message_problem <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY mp_problem_fk (problem_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> problem (problem_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 消息-接收者 (message_recipient)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> message_recipient <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY mr_message_fk (message_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> message (message_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> message_recipient <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY mr_recipient_fk (recipient_user_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> <span class="keyword">user</span> (user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 比赛-用户 (contest_user)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> contest_user <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY cu_contest_fk (contest_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> contest (contest_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> contest_user <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY cu_user_fk (user_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> <span class="keyword">user</span> (user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 题目-提交 (problem_submission)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> problem_submission <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY ps_problem_fk (problem_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> problem (problem_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> problem_submission <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY ps_submission_fk (submission_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> submission (submission_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 好友关系 (friendship)</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> friendship <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY friendship_user_fk (user_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> <span class="keyword">user</span> (user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> friendship <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> KEY friendship_friend_fk (friend_id)</span><br><span class="line">    <span class="keyword">REFERENCES</span> <span class="keyword">user</span> (user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br></pre></td></tr></table></figure>
<p><strong>好友关系外键说明</strong>：</p>
<ul>
<li>user_id 和 friend_id 都引用 user 表的 user_id，形成自引用关系</li>
<li>ON DELETE CASCADE 确保用户删除时，相关的所有好友关系记录也被删除</li>
<li>user_id 和 friend_id 的组合应设置 UNIQUE 约束，防止重复的好友关系</li>
</ul>
<h2 id="四、系统实现设计"><a href="#四、系统实现设计" class="headerlink" title="四、系统实现设计"></a>四、系统实现设计</h2><p>本节给出 CodeFuse 系统的实现设计，覆盖整体架构、后端实现细节、前端实现细节、评测引擎、关键 API 契约。目标是将前面的概念设计落地为可实现、可维护、可扩展的工程方案。</p>
<h3 id="4-1-总体架构"><a href="#4-1-总体架构" class="headerlink" title="4.1 总体架构"></a>4.1 总体架构</h3><p>系统采用前后端分离架构：</p>
<ul>
<li><strong>后端</strong>：基于 Python FastAPI 框架，提供 RESTful API 服务，负责业务逻辑处理、数据持久化、用户认证授权</li>
<li><strong>评测引擎</strong>：独立的代码评测模块，支持 C/C++、Python、Java 多语言编译运行，通过线程池实现并发评测</li>
<li><strong>前端</strong>：基于 Vue 3 + Element Plus 构建的单页应用（SPA），通过 Axios 与后端 API 交互</li>
<li><strong>静态文件与上传</strong>：后端通过 FastAPI StaticFiles 中间件挂载 <code>/uploads</code> 目录，提供用户头像等静态资源服务</li>
</ul>
<p><strong>架构图（逻辑层面）</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    subgraph Client [用户浏览器]</span><br><span class="line">        Browser[&quot;Vue 3 SPA + Element Plus&quot;]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph Backend [FastAPI 后端服务]</span><br><span class="line">        direction TB</span><br><span class="line">        </span><br><span class="line">        subgraph Middleware [接入层]</span><br><span class="line">            direction LR</span><br><span class="line">            Routers[&quot;路由层&lt;br&gt;(Routers)&quot;]</span><br><span class="line">            Auth[&quot;认证中间件&lt;br&gt;(JWT Auth)&quot;]</span><br><span class="line">            Static[&quot;静态文件&lt;br&gt;(Uploads)&quot;]</span><br><span class="line">            CORS[&quot;CORS 中间件&quot;]</span><br><span class="line">        end</span><br><span class="line"></span><br><span class="line">        Logic[&quot;业务逻辑层&lt;br&gt;users | problems | contests | submissions | messages | friendships&quot;]</span><br><span class="line">        </span><br><span class="line">        DAL[&quot;数据访问层&lt;br&gt;SQLAlchemy + 原生SQL (execute_query/execute_insert)&quot;]</span><br><span class="line"></span><br><span class="line">        Routers --&gt; Logic</span><br><span class="line">        Logic --&gt; DAL</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph Infra [基础设施]</span><br><span class="line">        direction LR</span><br><span class="line">        DB[(&quot;MySQL 数据库&lt;br&gt;(13张表)&quot;)]</span><br><span class="line">        FS[&quot;文件系统&lt;br&gt;(uploads/)&quot;]</span><br><span class="line">        Judge[&quot;评测引擎&lt;br&gt;(JudgeEngine)&lt;br&gt;ThreadPoolExecutor&quot;]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    Browser == &quot;HTTP/HTTPS (RESTful API)&quot; ==&gt; Routers</span><br><span class="line">    DAL --&gt; DB</span><br><span class="line">    DAL --&gt; FS</span><br><span class="line">    DAL --&gt; Judge</span><br></pre></td></tr></table></figure>
<h3 id="4-2-数据库物理设计"><a href="#4-2-数据库物理设计" class="headerlink" title="4.2 数据库物理设计"></a>4.2 数据库物理设计</h3><p>本系统采用 MySQL 5.7+ 作为关系型数据库，使用 InnoDB 存储引擎。</p>
<h4 id="4-2-1-存取方法"><a href="#4-2-1-存取方法" class="headerlink" title="4.2.1 存取方法"></a>4.2.1 存取方法</h4><p>系统主要采用以下存取方法以保证数据访问的高效性：</p>
<ol>
<li><p><strong>主键索引访问 (Primary Key Access)</strong>：</p>
<ul>
<li>这是系统中最常用的访问方式，用于通过 ID 精确查找实体（如用户、题目、提交记录等）。</li>
<li>InnoDB 引擎下，主键索引为聚簇索引 (Clustered Index)，数据行直接存储在主键索引的叶子节点中，查询效率最高。</li>
</ul>
</li>
<li><p><strong>唯一索引访问 (Unique Index Access)</strong>：</p>
<ul>
<li>用于通过 <code>username</code> 或 <code>email</code> 查找用户。</li>
<li>保证了数据的唯一性约束，同时提供了快速的查找能力。</li>
</ul>
</li>
<li><p><strong>辅助索引访问 (Secondary Index Access)</strong>：</p>
<ul>
<li>用于通过外键查找关联数据（如查找某用户的所有提交、某比赛的所有题目）。</li>
<li>辅助索引存储了索引列的值和对应的主键值，通常需要回表查询（除非覆盖索引）。</li>
</ul>
</li>
<li><p><strong>全表扫描 (Full Table Scan)</strong>：</p>
<ul>
<li>仅在数据量较小或无法利用索引的复杂查询（如多条件模糊搜索且未命中索引）时使用。系统设计中尽量避免此类操作。</li>
</ul>
</li>
</ol>
<h4 id="4-2-2-索引定义"><a href="#4-2-2-索引定义" class="headerlink" title="4.2.2 索引定义"></a>4.2.2 索引定义</h4><p>根据系统的数据模型，各表的索引定义如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">表名</th>
<th style="text-align:left">索引名称</th>
<th style="text-align:left">索引类型</th>
<th style="text-align:left">索引列</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>user</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>user_id</code></td>
<td style="text-align:left">聚簇索引，用户唯一标识</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">idx_username</td>
<td style="text-align:left">Unique</td>
<td style="text-align:left"><code>username</code></td>
<td style="text-align:left">用户名唯一</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">idx_email</td>
<td style="text-align:left">Unique</td>
<td style="text-align:left"><code>email</code></td>
<td style="text-align:left">邮箱唯一</td>
</tr>
<tr>
<td style="text-align:left"><strong>problem</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>problem_id</code></td>
<td style="text-align:left">聚簇索引，题目唯一标识</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_problem_creator</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>creator_id</code></td>
<td style="text-align:left">关联创建者</td>
</tr>
<tr>
<td style="text-align:left"><strong>contest</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>contest_id</code></td>
<td style="text-align:left">聚簇索引，比赛唯一标识</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_contest_creator</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>creator_id</code></td>
<td style="text-align:left">关联创建者</td>
</tr>
<tr>
<td style="text-align:left"><strong>message</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>message_id</code></td>
<td style="text-align:left">聚簇索引，消息唯一标识</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_message_creator</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>creator_id</code></td>
<td style="text-align:left">关联创建者</td>
</tr>
<tr>
<td style="text-align:left"><strong>submission</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>submission_id</code></td>
<td style="text-align:left">聚簇索引，提交记录唯一标识</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_submission_problem</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>problem_id</code></td>
<td style="text-align:left">关联题目</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_submission_contest</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>contest_id</code></td>
<td style="text-align:left">关联比赛</td>
</tr>
<tr>
<td style="text-align:left"><strong>contest_problem</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>contest_id</code>, <code>problem_id</code></td>
<td style="text-align:left">复合主键，聚簇索引</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_cp_problem</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>problem_id</code></td>
<td style="text-align:left">关联题目</td>
</tr>
<tr>
<td style="text-align:left"><strong>contest_user</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>contest_id</code>, <code>user_id</code></td>
<td style="text-align:left">复合主键，聚簇索引</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_cu_user</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>user_id</code></td>
<td style="text-align:left">关联用户</td>
</tr>
<tr>
<td style="text-align:left"><strong>message_problem</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>message_id</code>, <code>problem_id</code></td>
<td style="text-align:left">复合主键，聚簇索引</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_mp_problem</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>problem_id</code></td>
<td style="text-align:left">关联题目</td>
</tr>
<tr>
<td style="text-align:left"><strong>message_recipient</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>message_id</code>, <code>recipient_user_id</code></td>
<td style="text-align:left">复合主键，聚簇索引</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_mr_recipient</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>recipient_user_id</code></td>
<td style="text-align:left">关联接收者</td>
</tr>
<tr>
<td style="text-align:left"><strong>user_submission</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>user_id</code>, <code>submission_id</code></td>
<td style="text-align:left">复合主键，聚簇索引</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_us_submission</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>submission_id</code></td>
<td style="text-align:left">关联提交记录</td>
</tr>
<tr>
<td style="text-align:left"><strong>friendship</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>friendship_id</code></td>
<td style="text-align:left">聚簇索引</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_friendship_user</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>user_id</code></td>
<td style="text-align:left">关联发起者</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_friendship_friend</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>friend_id</code></td>
<td style="text-align:left">关联接收者</td>
</tr>
<tr>
<td style="text-align:left"><strong>activity_log</strong></td>
<td style="text-align:left">PRIMARY</td>
<td style="text-align:left">Primary</td>
<td style="text-align:left"><code>log_id</code></td>
<td style="text-align:left">聚簇索引</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">fk_log_user</td>
<td style="text-align:left">Foreign</td>
<td style="text-align:left"><code>user_id</code></td>
<td style="text-align:left">关联用户</td>
</tr>
</tbody>
</table>
</div>
<h3 id="4-3-后端实现设计"><a href="#4-3-后端实现设计" class="headerlink" title="4.3 后端实现设计"></a>4.3 后端实现设计</h3><p><strong>目标</strong>：提供高性能、安全、可维护的 RESTful API 服务，支持用户管理、题目管理、比赛管理、消息系统、好友系统、代码评测等核心功能。</p>
<h4 id="4-3-1-技术选型"><a href="#4-3-1-技术选型" class="headerlink" title="4.3.1 技术选型"></a>4.3.1 技术选型</h4><div class="table-container">
<table>
<thead>
<tr>
<th>技术组件</th>
<th>选型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Web框架</td>
<td>FastAPI</td>
<td>高性能异步Web框架，内置OpenAPI文档、请求验证</td>
</tr>
<tr>
<td>数据库</td>
<td>MySQL 5.7+</td>
<td>关系型数据库，支持JSON字段类型</td>
</tr>
<tr>
<td>ORM</td>
<td>SQLAlchemy</td>
<td>用于模型定义和数据库连接管理</td>
</tr>
<tr>
<td>SQL执行</td>
<td>原生SQL</td>
<td>通过封装函数执行原生SQL，保证性能和灵活性</td>
</tr>
<tr>
<td>认证</td>
<td>JWT (python-jose)</td>
<td>无状态令牌认证，支持过期时间配置</td>
</tr>
<tr>
<td>密码加密</td>
<td>bcrypt + SHA256</td>
<td>双重加密，绕过bcrypt 72字节限制</td>
</tr>
<tr>
<td>配置管理</td>
<td>pydantic-settings</td>
<td>环境变量配置，支持.env文件</td>
</tr>
<tr>
<td>进程管理</td>
<td>uvicorn</td>
<td>ASGI服务器，支持热重载</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-3-2-代码组织（基于现有仓库）"><a href="#4-3-2-代码组织（基于现有仓库）" class="headerlink" title="4.3.2 代码组织（基于现有仓库）"></a>4.3.2 代码组织（基于现有仓库）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">backend/</span><br><span class="line">├── pyproject.toml              # 项目依赖配置（Poetry）</span><br><span class="line">├── .env                        # 环境变量配置文件</span><br><span class="line">├── reset_database.py           # 数据库重置脚本</span><br><span class="line">├── start.bat / stop.bat        # Windows启停脚本</span><br><span class="line">├── uploads/                    # 用户上传文件目录</span><br><span class="line">│   └── avatars/               # 用户头像存储</span><br><span class="line">└── app/</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── main.py                # FastAPI应用入口，路由注册，中间件配置</span><br><span class="line">    ├── config.py              # 配置管理（数据库、JWT、评测引擎参数）</span><br><span class="line">    ├── database.py            # 数据库连接、会话管理、SQL执行封装</span><br><span class="line">    ├── models.py              # SQLAlchemy ORM模型定义（13个表）</span><br><span class="line">    ├── schemas.py             # Pydantic请求/响应模型</span><br><span class="line">    ├── auth.py                # 认证模块（JWT生成/验证、密码哈希）</span><br><span class="line">    ├── judge_engine.py        # 代码评测引擎核心（编译、运行、比对）</span><br><span class="line">    ├── judge_runner.py        # 评测任务执行器（单次评测逻辑）</span><br><span class="line">    ├── judge_worker.py        # 评测线程池管理</span><br><span class="line">    └── routers/               # API路由模块</span><br><span class="line">        ├── users.py           # 用户注册、登录、信息管理</span><br><span class="line">        ├── problems.py        # 题目CRUD、题目ID分配策略</span><br><span class="line">        ├── submissions.py     # 提交记录、评测触发、协作提交</span><br><span class="line">        ├── contests.py        # 比赛管理、报名、排行榜、题目发布</span><br><span class="line">        ├── messages.py        # 消息系统（私信、题目讨论）</span><br><span class="line">        ├── friendships.py     # 好友关系管理</span><br><span class="line">        ├── activity_logs.py   # 活动日志查询</span><br><span class="line">        └── test_cases_json.py # 测试点管理API</span><br></pre></td></tr></table></figure>
<h4 id="4-3-3-认证与权限"><a href="#4-3-3-认证与权限" class="headerlink" title="4.3.3 认证与权限"></a>4.3.3 认证与权限</h4><p><strong>认证流程</strong>：</p>
<ol>
<li><strong>用户登录</strong>：提交用户名/邮箱 + 密码，验证成功后返回 JWT Token</li>
<li><strong>请求认证</strong>：客户端在请求头携带 <code>Authorization: Bearer &lt;token&gt;</code></li>
<li><strong>Token验证</strong>：通过 <code>get_current_user</code> 依赖注入解析并验证Token</li>
</ol>
<p><strong>密码安全</strong>：采用 SHA256 + bcrypt 双重加密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_password_hash</span>(<span class="params">password: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># 先用 SHA256 预处理（绕过 bcrypt 72字节限制）</span></span><br><span class="line">    preprocessed = hashlib.sha256(password.encode(<span class="string">&#x27;utf-8&#x27;</span>)).digest()</span><br><span class="line">    salt = bcrypt.gensalt()</span><br><span class="line">    <span class="keyword">return</span> bcrypt.hashpw(preprocessed, salt).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>权限控制</strong>：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>角色</th>
<th>权限范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>user</td>
<td>查看公开题目、参加比赛、提交代码、发送消息、管理好友</td>
</tr>
<tr>
<td>admin</td>
<td>全部user权限 + 创建/修改/删除题目、管理比赛、查看所有数据、查看测试点详情</td>
</tr>
</tbody>
</table>
</div>
<p><strong>管理员注册</strong>：通过配置的 <code>ADMIN_REGISTER_CODE</code> 验证码实现安全的管理员账号注册</p>
<h4 id="4-3-4-文件上传与静态服务"><a href="#4-3-4-文件上传与静态服务" class="headerlink" title="4.3.4 文件上传与静态服务"></a>4.3.4 文件上传与静态服务</h4><p><strong>头像上传</strong>：</p>
<ul>
<li>端点：<code>POST /api/users/&#123;user_id&#125;/avatar</code></li>
<li>存储路径：<code>uploads/avatars/user_&#123;user_id&#125;.&#123;ext&#125;</code></li>
<li>支持格式：jpg, jpeg, png, gif</li>
<li>大小限制：由前端控制</li>
</ul>
<p><strong>静态文件服务</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py 中挂载静态目录</span></span><br><span class="line">app.mount(<span class="string">&quot;/api/uploads&quot;</span>, StaticFiles(directory=<span class="string">&quot;uploads&quot;</span>), name=<span class="string">&quot;uploads&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>前端通过 <code>&#123;API_BASE_URL&#125;/api/uploads/avatars/user_1.png</code> 访问用户头像</p>
<h4 id="4-3-5-数据一致性与迁移"><a href="#4-3-5-数据一致性与迁移" class="headerlink" title="4.3.5 数据一致性与迁移"></a>4.3.5 数据一致性与迁移</h4><p><strong>数据库初始化</strong>：</p>
<ul>
<li>SQLAlchemy <code>Base.metadata.create_all()</code> 自动创建表结构</li>
<li>题目表 <code>AUTO_INCREMENT=10000</code> 确保公开题目ID从10000开始</li>
</ul>
<p><strong>题目ID管理</strong>：</p>
<ul>
<li><strong>保留ID区间（1-9999）</strong>：比赛专用题目，手动分配最小可用ID</li>
<li><strong>公开ID区间（&gt;=10000）</strong>：公开题库题目，自动递增分配</li>
<li><strong>发布迁移</strong>：比赛结束后自动将保留ID题目迁移到公开区</li>
</ul>
<p><strong>外键级联</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除用户时级联删除相关数据</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line"><span class="comment">-- 比赛删除时，提交记录的contest_id置空</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>
<h4 id="4-3-6-日志与审计"><a href="#4-3-6-日志与审计" class="headerlink" title="4.3.6 日志与审计"></a>4.3.6 日志与审计</h4><p><strong>活动日志系统</strong>：通过 <code>activity_log</code> 表记录所有关键操作</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>操作类型</th>
<th>实体类型</th>
<th>记录内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>create</td>
<td>user</td>
<td>用户注册</td>
</tr>
<tr>
<td>submit</td>
<td>submission</td>
<td>代码提交</td>
</tr>
<tr>
<td>create/update/delete</td>
<td>problem</td>
<td>题目管理</td>
</tr>
<tr>
<td>create/update/delete</td>
<td>contest</td>
<td>比赛管理</td>
</tr>
</tbody>
</table>
</div>
<p><strong>日志记录示例</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">execute_insert(db, <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    INSERT INTO activity_log (user_id, action_type, entity_type, entity_id, description, created_at)</span></span><br><span class="line"><span class="string">    VALUES (:user_id, :action_type, :entity_type, :entity_id, :description, :created_at)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>, &#123;</span><br><span class="line">    <span class="string">&quot;user_id&quot;</span>: user_id,</span><br><span class="line">    <span class="string">&quot;action_type&quot;</span>: <span class="string">&quot;submit&quot;</span>,</span><br><span class="line">    <span class="string">&quot;entity_type&quot;</span>: <span class="string">&quot;submission&quot;</span>,</span><br><span class="line">    <span class="string">&quot;entity_id&quot;</span>: submission_id,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">f&quot;用户 <span class="subst">&#123;username&#125;</span> 提交了题目《<span class="subst">&#123;problem_title&#125;</span>》&quot;</span>,</span><br><span class="line">    <span class="string">&quot;created_at&quot;</span>: datetime.utcnow()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="4-3-7-常用-API-设计原则"><a href="#4-3-7-常用-API-设计原则" class="headerlink" title="4.3.7 常用 API 设计原则"></a>4.3.7 常用 API 设计原则</h4><ol>
<li><strong>RESTful 风格</strong>：资源导向的URL设计（<code>/api/users</code>, <code>/api/problems/&#123;id&#125;</code>）</li>
<li><strong>统一响应格式</strong>：成功返回数据对象，失败返回 <code>&#123;&quot;detail&quot;: &quot;错误信息&quot;&#125;</code></li>
<li><strong>分页查询</strong>：支持 <code>skip</code>、<code>limit</code> 参数</li>
<li><strong>搜索过滤</strong>：支持 <code>search</code>、<code>difficulty</code>、<code>tags</code> 等筛选参数</li>
<li><strong>排序控制</strong>：支持 <code>sort_by</code>、<code>order</code> 参数</li>
<li><strong>HTTP状态码</strong>：200成功、201创建、400参数错误、401未认证、403无权限、404未找到</li>
</ol>
<h3 id="4-4-前端实现设计"><a href="#4-4-前端实现设计" class="headerlink" title="4.4 前端实现设计"></a>4.4 前端实现设计</h3><h4 id="4-4-1-技术栈与结构"><a href="#4-4-1-技术栈与结构" class="headerlink" title="4.4.1 技术栈与结构"></a>4.4.1 技术栈与结构</h4><div class="table-container">
<table>
<thead>
<tr>
<th>技术组件</th>
<th>选型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>框架</td>
<td>Vue 3</td>
<td>组合式API，响应式数据绑定</td>
</tr>
<tr>
<td>路由</td>
<td>Vue Router 4</td>
<td>SPA路由管理，支持路由守卫</td>
</tr>
<tr>
<td>UI组件库</td>
<td>Element Plus 2.4</td>
<td>丰富的企业级UI组件</td>
</tr>
<tr>
<td>HTTP客户端</td>
<td>Axios 1.6</td>
<td>请求/响应拦截器，Token自动携带</td>
</tr>
<tr>
<td>构建工具</td>
<td>Vite 5</td>
<td>快速的开发服务器和构建工具</td>
</tr>
<tr>
<td>Markdown渲染</td>
<td>marked 11 + DOMPurify</td>
<td>安全的Markdown解析和渲染</td>
</tr>
<tr>
<td>代码高亮</td>
<td>highlight.js 11</td>
<td>多语言代码语法高亮</td>
</tr>
<tr>
<td>数学公式</td>
<td>KaTeX 0.16</td>
<td>LaTeX数学公式渲染</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-4-2-代码组织（基于现有仓库）"><a href="#4-4-2-代码组织（基于现有仓库）" class="headerlink" title="4.4.2 代码组织（基于现有仓库）"></a>4.4.2 代码组织（基于现有仓库）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">frontend/</span><br><span class="line">├── index.html                  # HTML入口文件</span><br><span class="line">├── package.json                # NPM依赖配置</span><br><span class="line">├── vite.config.js              # Vite构建配置（代理、别名等）</span><br><span class="line">├── start.bat / stop.bat        # Windows启停脚本</span><br><span class="line">└── src/</span><br><span class="line">    ├── main.js                 # Vue应用入口，全局组件注册</span><br><span class="line">    ├── App.vue                 # 根组件（导航栏、登录/注册对话框）</span><br><span class="line">    ├── api.js                  # Axios实例配置（拦截器、baseURL）</span><br><span class="line">    ├── router/</span><br><span class="line">    │   └── index.js            # 路由配置，路由守卫</span><br><span class="line">    ├── views/                  # 页面级组件</span><br><span class="line">    │   ├── Home.vue            # 首页（系统介绍、统计）</span><br><span class="line">    │   ├── Problems.vue        # 题目列表（搜索、筛选、分页）</span><br><span class="line">    │   ├── ProblemDetail.vue   # 题目详情（描述、代码提交、讨论）</span><br><span class="line">    │   ├── Submissions.vue     # 提交记录列表</span><br><span class="line">    │   ├── Contests.vue        # 比赛列表</span><br><span class="line">    │   ├── ContestDetail.vue   # 比赛详情（题目、排行榜）</span><br><span class="line">    │   ├── Messages.vue        # 消息中心（私信、讨论）</span><br><span class="line">    │   ├── Friends.vue         # 好友管理</span><br><span class="line">    │   ├── Profile.vue         # 个人信息编辑</span><br><span class="line">    │   ├── UserDetail.vue      # 用户详情页</span><br><span class="line">    │   ├── Admin.vue           # 管理后台</span><br><span class="line">    │   └── TestCaseManager.vue # 测试点管理</span><br><span class="line">    ├── components/             # 可复用组件</span><br><span class="line">    │   ├── CodeViewer.vue      # 代码查看器（语法高亮）</span><br><span class="line">    │   └── MarkdownEditor.vue  # Markdown编辑器</span><br><span class="line">    ├── styles/                 # 全局样式</span><br><span class="line">    │   ├── global.css          # 全局样式</span><br><span class="line">    │   └── theme-dark.css      # 暗色主题</span><br><span class="line">    └── utils/                  # 工具函数</span><br><span class="line">        ├── avatar.js           # 头像URL处理</span><br><span class="line">        ├── markdown.js         # Markdown渲染配置</span><br><span class="line">        └── theme.js            # 主题切换</span><br></pre></td></tr></table></figure>
<h4 id="4-4-3-交互与实时性"><a href="#4-4-3-交互与实时性" class="headerlink" title="4.4.3 交互与实时性"></a>4.4.3 交互与实时性</h4><p><strong>请求拦截器</strong>：自动携带JWT Token</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">api.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">        config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>响应拦截器</strong>：401自动登出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">api.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function"><span class="params">response</span> =&gt;</span> response,</span><br><span class="line">    <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (error.<span class="property">response</span>?.<span class="property">status</span> === <span class="number">401</span>) &#123;</span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>路由守卫</strong>：权限控制</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">meta</span>.<span class="property">requiresAdmin</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> userRole = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;userRole&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (userRole !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_">next</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>评测状态轮询</strong>：提交代码后轮询获取评测结果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提交后轮询检查评测状态</span></span><br><span class="line"><span class="keyword">const</span> pollInterval = <span class="built_in">setInterval</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> api.<span class="title function_">get</span>(<span class="string">`/api/submissions/<span class="subst">$&#123;submissionId&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">data</span>.<span class="property">status</span> !== <span class="string">&#x27;judging&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">clearInterval</span>(pollInterval)</span><br><span class="line">        <span class="comment">// 显示评测结果</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<h3 id="4-5-评测引擎"><a href="#4-5-评测引擎" class="headerlink" title="4.5 评测引擎"></a>4.5 评测引擎</h3><p>评测是 CodeFuse 的核心功能，应保证安全、可伸缩、可审计。</p>
<h4 id="4-5-1-评测流程（高层）"><a href="#4-5-1-评测流程（高层）" class="headerlink" title="4.5.1 评测流程（高层）"></a>4.5.1 评测流程（高层）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    subgraph API [&quot;1. 提交创建&quot;]</span><br><span class="line">        A[API接口&lt;br&gt;POST /submissions] --&gt;|status=&#x27;judging&#x27;| B[返回 submission_id]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph Queue [&quot;2. 任务入队&quot;]</span><br><span class="line">        A --&gt;|后台任务| C[线程池队列&lt;br&gt;submit]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph Execution [&quot;3. 线程执行&quot;]</span><br><span class="line">        C --&gt; D[JudgeRunner&lt;br&gt;逐测试点评测]</span><br><span class="line">        </span><br><span class="line">        subgraph Engine [&quot;JudgeEngine&quot;]</span><br><span class="line">            D --&gt; E[编译代码]</span><br><span class="line">            E --&gt; F[运行程序&lt;br&gt;带超时/内存限制]</span><br><span class="line">            F --&gt; G[比对输出]</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph Storage [&quot;4. 结果存储&quot;]</span><br><span class="line">        G --&gt; H[数据库&lt;br&gt;UPDATE submission]</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>
<p><strong>评测状态转换</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">judging → accepted          (所有测试点通过)</span><br><span class="line">        → wrong_answer      (输出不匹配)</span><br><span class="line">        → time_limit_exceeded (运行超时)</span><br><span class="line">        → memory_limit_exceeded (内存超限)</span><br><span class="line">        → runtime_error     (运行时错误)</span><br><span class="line">        → compile_error     (编译错误)</span><br><span class="line">        → system_error      (系统异常)</span><br></pre></td></tr></table></figure>
<h4 id="4-5-2-沙箱与安全"><a href="#4-5-2-沙箱与安全" class="headerlink" title="4.5.2 沙箱与安全"></a>4.5.2 沙箱与安全</h4><p><strong>进程隔离</strong>：每次评测使用独立的子进程（<code>subprocess.Popen</code>）</p>
<p><strong>资源限制</strong>：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>限制类型</th>
<th>实现方式</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>时间限制</td>
<td><code>subprocess.communicate(timeout=)</code></td>
<td>配置的time_limit</td>
</tr>
<tr>
<td>内存限制</td>
<td><code>psutil</code> 持续监控内存使用</td>
<td>配置的memory_limit</td>
</tr>
</tbody>
</table>
</div>
<p><strong>内存监控实现</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">monitor_memory</span>():</span><br><span class="line">    ps_process = psutil.Process(process.pid)</span><br><span class="line">    <span class="keyword">while</span> monitoring[<span class="string">&#x27;running&#x27;</span>]:</span><br><span class="line">        memory_info = ps_process.memory_info()</span><br><span class="line">        current_memory = memory_info.rss // <span class="number">1024</span>  <span class="comment"># KB</span></span><br><span class="line">        max_memory = <span class="built_in">max</span>(max_memory, current_memory)</span><br><span class="line">        time.sleep(<span class="number">0.01</span>)  <span class="comment"># 每10ms检查一次</span></span><br></pre></td></tr></table></figure>
<p><strong>临时文件管理</strong>：</p>
<ul>
<li>每次评测创建独立临时目录（Java）或临时文件（C/C++/Python）</li>
<li>评测完成后自动清理所有临时文件</li>
<li>Java使用独立子目录避免并发时 Main.class 冲突</li>
</ul>
<p><strong>编译器路径配置</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config.py 中配置</span></span><br><span class="line">PYTHON_EXECUTABLE: <span class="built_in">str</span>    <span class="comment"># Python 解释器路径</span></span><br><span class="line">GCC_EXECUTABLE: <span class="built_in">str</span>       <span class="comment"># GCC 编译器路径</span></span><br><span class="line">GPP_EXECUTABLE: <span class="built_in">str</span>       <span class="comment"># G++ 编译器路径</span></span><br><span class="line">JAVAC_EXECUTABLE: <span class="built_in">str</span>     <span class="comment"># Java 编译器路径</span></span><br><span class="line">JAVA_EXECUTABLE: <span class="built_in">str</span>      <span class="comment"># Java 运行时路径</span></span><br></pre></td></tr></table></figure>
<h4 id="4-5-3-并发与扩展"><a href="#4-5-3-并发与扩展" class="headerlink" title="4.5.3 并发与扩展"></a>4.5.3 并发与扩展</h4><p><strong>线程池管理</strong>（<code>judge_worker.py</code>）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">_JudgePoolManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, max_workers: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.executor = ThreadPoolExecutor(max_workers=max_workers)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">submit</span>(<span class="params">self, submission_id: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;提交评测任务到线程池&quot;&quot;&quot;</span></span><br><span class="line">        future = <span class="variable language_">self</span>.executor.submit(wrapper, submission_id)</span><br><span class="line">        <span class="keyword">return</span> future</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_stats</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取线程池状态&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;max_workers&#x27;</span>: <span class="variable language_">self</span>.max_workers,</span><br><span class="line">            <span class="string">&#x27;pending&#x27;</span>: pending_count,</span><br><span class="line">            <span class="string">&#x27;running&#x27;</span>: running_count</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p><strong>并发配置</strong>：通过 <code>JUDGE_MAX_WORKERS</code> 环境变量配置最大并发评测数（默认4）</p>
<p><strong>异步提交</strong>：使用 FastAPI <code>BackgroundTasks</code> 实现非阻塞评测</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.post(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_submission</span>(<span class="params">submission: SubmissionCreate, background_tasks: BackgroundTasks</span>):</span><br><span class="line">    <span class="comment"># 创建提交记录（status=&#x27;judging&#x27;）</span></span><br><span class="line">    submission_id = execute_insert(...)</span><br><span class="line">    <span class="comment"># 异步触发评测</span></span><br><span class="line">    background_tasks.add_task(_background_judge, submission_id)</span><br><span class="line">    <span class="comment"># 立即返回，不等待评测完成</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;submission_id&quot;</span>: submission_id&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-5-4-重测与历史"><a href="#4-5-4-重测与历史" class="headerlink" title="4.5.4 重测与历史"></a>4.5.4 重测与历史</h4><p><strong>评测结果存储</strong>：<code>judge_results</code> 字段存储完整评测历史</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test_case_index&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;accepted&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;time_used&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;memory_used&quot;</span><span class="punctuation">:</span> <span class="number">14000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="number">50</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;input_data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2 3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;expected_output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;actual_output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error_message&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test_case_index&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wrong_answer&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;time_used&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;memory_used&quot;</span><span class="punctuation">:</span> <span class="number">14500</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;input_data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10 20&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;expected_output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;actual_output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;31&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error_message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;实际输出和期望输出不符合&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p><strong>历史数据保护</strong>：评测结果中保存当时的输入数据和期望输出，即使后续修改测试点也能追溯历史评测详情</p>
<p><strong>权限控制</strong>：</p>
<ul>
<li>普通用户：只能查看 status、time_used、memory_used、score</li>
<li>管理员：可查看完整信息包括 input_data、expected_output、actual_output</li>
</ul>
<h3 id="4-6-关键-API-契约"><a href="#4-6-关键-API-契约" class="headerlink" title="4.6 关键 API 契约"></a>4.6 关键 API 契约</h3><p><strong>说明</strong>：以下列出系统核心API端点的契约定义，完整API文档可通过访问 <code>/docs</code>（Swagger UI）或 <code>/redoc</code> 获取。</p>
<h4 id="4-6-1-用户模块-api-users"><a href="#4-6-1-用户模块-api-users" class="headerlink" title="4.6.1 用户模块 (/api/users)"></a>4.6.1 用户模块 (<code>/api/users</code>)</h4><div class="table-container">
<table>
<thead>
<tr>
<th>端点</th>
<th>方法</th>
<th>说明</th>
<th>认证</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/register</code></td>
<td>POST</td>
<td>用户注册（支持管理员注册码）</td>
<td>否</td>
</tr>
<tr>
<td><code>/login</code></td>
<td>POST</td>
<td>用户登录，返回JWT Token</td>
<td>否</td>
</tr>
<tr>
<td><code>/me</code></td>
<td>GET</td>
<td>获取当前登录用户信息</td>
<td>是</td>
</tr>
<tr>
<td><code>/</code></td>
<td>GET</td>
<td>获取用户列表（支持搜索、筛选）</td>
<td>否</td>
</tr>
<tr>
<td><code>/&#123;user_id&#125;</code></td>
<td>GET</td>
<td>获取指定用户信息</td>
<td>否</td>
</tr>
<tr>
<td><code>/&#123;user_id&#125;</code></td>
<td>PUT</td>
<td>更新用户信息</td>
<td>是（本人或管理员）</td>
</tr>
<tr>
<td><code>/&#123;user_id&#125;</code></td>
<td>DELETE</td>
<td>删除用户</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;user_id&#125;/avatar</code></td>
<td>POST</td>
<td>上传用户头像</td>
<td>是（本人或管理员）</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-6-2-题目模块-api-problems"><a href="#4-6-2-题目模块-api-problems" class="headerlink" title="4.6.2 题目模块 (/api/problems)"></a>4.6.2 题目模块 (<code>/api/problems</code>)</h4><div class="table-container">
<table>
<thead>
<tr>
<th>端点</th>
<th>方法</th>
<th>说明</th>
<th>认证</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code></td>
<td>GET</td>
<td>获取题目列表（支持搜索、难度筛选）</td>
<td>否</td>
</tr>
<tr>
<td><code>/</code></td>
<td>POST</td>
<td>创建题目</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;problem_id&#125;</code></td>
<td>GET</td>
<td>获取题目详情</td>
<td>否（比赛题目需验证）</td>
</tr>
<tr>
<td><code>/&#123;problem_id&#125;</code></td>
<td>PUT</td>
<td>更新题目</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;problem_id&#125;</code></td>
<td>DELETE</td>
<td>删除题目</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;problem_id&#125;/test-cases</code></td>
<td>GET</td>
<td>获取测试点列表</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;problem_id&#125;/test-cases</code></td>
<td>PUT</td>
<td>更新测试点</td>
<td>是（管理员）</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-6-3-提交模块-api-submissions"><a href="#4-6-3-提交模块-api-submissions" class="headerlink" title="4.6.3 提交模块 (/api/submissions)"></a>4.6.3 提交模块 (<code>/api/submissions</code>)</h4><div class="table-container">
<table>
<thead>
<tr>
<th>端点</th>
<th>方法</th>
<th>说明</th>
<th>认证</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code></td>
<td>POST</td>
<td>创建提交（支持协作提交）</td>
<td>是</td>
</tr>
<tr>
<td><code>/</code></td>
<td>GET</td>
<td>获取提交记录列表</td>
<td>否</td>
</tr>
<tr>
<td><code>/&#123;submission_id&#125;</code></td>
<td>GET</td>
<td>获取提交详情（含评测结果）</td>
<td>否</td>
</tr>
<tr>
<td><code>/&#123;submission_id&#125;</code></td>
<td>DELETE</td>
<td>删除提交记录</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;submission_id&#125;/judge-results</code></td>
<td>GET</td>
<td>获取详细评测结果</td>
<td>是（敏感信息仅管理员可见）</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-6-4-比赛模块-api-contests"><a href="#4-6-4-比赛模块-api-contests" class="headerlink" title="4.6.4 比赛模块 (/api/contests)"></a>4.6.4 比赛模块 (<code>/api/contests</code>)</h4><div class="table-container">
<table>
<thead>
<tr>
<th>端点</th>
<th>方法</th>
<th>说明</th>
<th>认证</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code></td>
<td>GET</td>
<td>获取比赛列表</td>
<td>否</td>
</tr>
<tr>
<td><code>/</code></td>
<td>POST</td>
<td>创建比赛</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;contest_id&#125;</code></td>
<td>GET</td>
<td>获取比赛详情</td>
<td>否</td>
</tr>
<tr>
<td><code>/&#123;contest_id&#125;</code></td>
<td>PUT</td>
<td>更新比赛</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;contest_id&#125;</code></td>
<td>DELETE</td>
<td>删除比赛</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;contest_id&#125;/register</code></td>
<td>POST</td>
<td>报名比赛</td>
<td>是</td>
</tr>
<tr>
<td><code>/&#123;contest_id&#125;/problems</code></td>
<td>GET</td>
<td>获取比赛题目列表</td>
<td>否（比赛中需已报名）</td>
</tr>
<tr>
<td><code>/&#123;contest_id&#125;/problems</code></td>
<td>POST</td>
<td>添加题目到比赛</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/&#123;contest_id&#125;/ranking</code></td>
<td>GET</td>
<td>获取比赛排行榜</td>
<td>否</td>
</tr>
<tr>
<td><code>/&#123;contest_id&#125;/publish_invisible_problems</code></td>
<td>POST</td>
<td>发布比赛题目到公开题库</td>
<td>是（管理员）</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-6-5-消息模块-api-messages"><a href="#4-6-5-消息模块-api-messages" class="headerlink" title="4.6.5 消息模块 (/api/messages)"></a>4.6.5 消息模块 (<code>/api/messages</code>)</h4><div class="table-container">
<table>
<thead>
<tr>
<th>端点</th>
<th>方法</th>
<th>说明</th>
<th>认证</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code></td>
<td>POST</td>
<td>创建消息（私信/讨论）</td>
<td>是</td>
</tr>
<tr>
<td><code>/</code></td>
<td>GET</td>
<td>获取消息列表</td>
<td>是</td>
</tr>
<tr>
<td><code>/&#123;message_id&#125;</code></td>
<td>GET</td>
<td>获取消息详情</td>
<td>是</td>
</tr>
<tr>
<td><code>/&#123;message_id&#125;</code></td>
<td>DELETE</td>
<td>删除消息</td>
<td>是（创建者或管理员）</td>
</tr>
<tr>
<td><code>/problem/&#123;problem_id&#125;</code></td>
<td>GET</td>
<td>获取题目讨论列表</td>
<td>否</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-6-6-好友模块-api-friendships"><a href="#4-6-6-好友模块-api-friendships" class="headerlink" title="4.6.6 好友模块 (/api/friendships)"></a>4.6.6 好友模块 (<code>/api/friendships</code>)</h4><div class="table-container">
<table>
<thead>
<tr>
<th>端点</th>
<th>方法</th>
<th>说明</th>
<th>认证</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code></td>
<td>POST</td>
<td>发送好友请求</td>
<td>是</td>
</tr>
<tr>
<td><code>/requests</code></td>
<td>GET</td>
<td>获取收到的好友请求</td>
<td>是</td>
</tr>
<tr>
<td><code>/sent</code></td>
<td>GET</td>
<td>获取发送的好友请求</td>
<td>是</td>
</tr>
<tr>
<td><code>/friends</code></td>
<td>GET</td>
<td>获取好友列表</td>
<td>是</td>
</tr>
<tr>
<td><code>/&#123;friendship_id&#125;/accept</code></td>
<td>PUT</td>
<td>接受好友请求</td>
<td>是</td>
</tr>
<tr>
<td><code>/&#123;friendship_id&#125;/reject</code></td>
<td>PUT</td>
<td>拒绝好友请求</td>
<td>是</td>
</tr>
<tr>
<td><code>/&#123;friendship_id&#125;/block</code></td>
<td>PUT</td>
<td>屏蔽用户</td>
<td>是</td>
</tr>
<tr>
<td><code>/&#123;friendship_id&#125;</code></td>
<td>DELETE</td>
<td>删除好友关系</td>
<td>是</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-6-7-活动日志模块-api-activity-logs"><a href="#4-6-7-活动日志模块-api-activity-logs" class="headerlink" title="4.6.7 活动日志模块 (/api/activity-logs)"></a>4.6.7 活动日志模块 (<code>/api/activity-logs</code>)</h4><div class="table-container">
<table>
<thead>
<tr>
<th>端点</th>
<th>方法</th>
<th>说明</th>
<th>认证</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code></td>
<td>GET</td>
<td>获取活动日志列表</td>
<td>是（管理员）</td>
</tr>
<tr>
<td><code>/recent</code></td>
<td>GET</td>
<td>获取最近活动</td>
<td>是（管理员）</td>
</tr>
</tbody>
</table>
</div>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>作者: </span><span class="post-copyright-info"><a href="https://wrongization.site">wrongization</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>链接: </span><span class="post-copyright-info"><a href="https://wrongization.site/2026/01/10/db.html">https://wrongization.site/2026/01/10/db.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>转载注意: </span><span class="post-copyright-info">除非另有说明，否则本博客中的所有文章均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a><a class="post-meta__tags" href="/tags/sql/">sql</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/db/db.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2026/01/10/compile.html" title="BUAA 2025编译实验"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/compile/compile.webp" onerror="onerror=null;src='/img/404.webp'" alt="cover of previous post"><div class="pagination-info"><div class="label">明夜</div><div class="prev_info">BUAA 2025编译实验</div></div></a></div><div class="next-post pull-right"><a href="/2025/08/20/python.html" title="Python-CUDA-CuDNN-Pytorch-Jupyter配置合集"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/python/python.webp" onerror="onerror=null;src='/img/404.webp'" alt="cover of next post"><div class="pagination-info"><div class="label">昨夜</div><div class="next_info">Python-CUDA-CuDNN-Pytorch-Jupyter配置合集</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关文章</span></div><div class="relatedPosts-list"><div><a href="/2025/08/20/python.html" title="Python-CUDA-CuDNN-Pytorch-Jupyter配置合集"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/python/python.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-20</div><div class="title">Python-CUDA-CuDNN-Pytorch-Jupyter配置合集</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo.webp" onerror="this.onerror=null;this.src='/img/gif404.gif'" alt="avatar"/></div><div class="author-info__name">wrongization</div><div class="author-info__description">wrongization的博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">类别</div><div class="length-num">30</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wrongization"><i class="fab fa-github"></i><span>My Github Page</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://space.bilibili.com/175003959" target="_blank" title="bilibili"><i class="fab fa-bilibili" style="color: #FF69B4;"></i></a><a class="social-icon" href="https://500px.com.cn/wrongization" target="_blank" title="500px"><i class="fab fa-500px" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2560668452@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #7D26CD;"></i></a><a class="social-icon" href="https://steamcommunity.com/id/wrongization" target="_blank" title="steam"><i class="fab fa-steam-square" style="color: #00008B;"></i></a><a class="social-icon" href="https://www.test-ipv6.com/index.html.zh_CN" target="_blank" title="ipv6测试"><i class="fas fa-spinner fa-pulse" style="color: #00EE00;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">可以先看软件配置系列，顶部菜单栏可选择不同子页面。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CodeFuse-%E2%80%94%E2%80%94-%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3"><span class="toc-text">CodeFuse —— 编程学习系统设计文档</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-text">一、需求分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E9%9C%80%E6%B1%82%E6%8F%8F%E8%BF%B0"><span class="toc-text">1.1 需求描述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E8%83%8C%E6%99%AF%E8%B0%83%E7%A0%94"><span class="toc-text">1.1.1 背景调研</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-%E7%94%A8%E6%88%B7%E8%B0%83%E7%A0%94"><span class="toc-text">1.1.2 用户调研</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3-%E9%9C%80%E6%B1%82%E6%80%BB%E7%BB%93"><span class="toc-text">1.1.3 需求总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-4-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8A%BF"><span class="toc-text">1.1.4 项目优势</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE"><span class="toc-text">1.2 数据流图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%95%B0%E6%8D%AE%E5%85%83%E7%B4%A0%E8%A1%A8"><span class="toc-text">1.3 数据元素表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E8%A1%A8%EF%BC%886-%E4%B8%AA%EF%BC%89"><span class="toc-text">实体表（6 个）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0-%E7%94%A8%E6%88%B7-user"><span class="toc-text">① 用户 (user)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1-%E9%A2%98%E7%9B%AE-problem"><span class="toc-text">② 题目 (problem)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A2-%E6%AF%94%E8%B5%9B-contest"><span class="toc-text">③ 比赛 (contest)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A3-%E6%B6%88%E6%81%AF-message"><span class="toc-text">④ 消息 (message)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A4-%E6%8F%90%E4%BA%A4-submission"><span class="toc-text">⑤ 提交 (submission)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A5-%E6%B4%BB%E5%8A%A8%E6%97%A5%E5%BF%97-activity-log"><span class="toc-text">⑥ 活动日志 (activity_log)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E7%B3%BB%E8%A1%A8%EF%BC%887-%E4%B8%AA%EF%BC%89"><span class="toc-text">联系表（7 个）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0-%E6%AF%94%E8%B5%9B-%E9%A2%98%E7%9B%AE-contest-problem"><span class="toc-text">① 比赛-题目 (contest_problem)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1-%E6%AF%94%E8%B5%9B-%E7%94%A8%E6%88%B7-contest-user"><span class="toc-text">② 比赛-用户 (contest_user)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A2-%E6%B6%88%E6%81%AF-%E9%A2%98%E7%9B%AE-message-problem"><span class="toc-text">③ 消息-题目 (message_problem)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A3-%E6%B6%88%E6%81%AF-%E6%8E%A5%E6%94%B6%E8%80%85-message-recipient"><span class="toc-text">④ 消息-接收者 (message_recipient)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A4-%E9%A2%98%E7%9B%AE-%E6%8F%90%E4%BA%A4-problem-submission"><span class="toc-text">⑤ 题目-提交 (problem_submission)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A5-%E7%94%A8%E6%88%B7-%E6%8F%90%E4%BA%A4-user-submission"><span class="toc-text">⑥ 用户-提交 (user_submission)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A6-%E5%A5%BD%E5%8F%8B%E5%85%B3%E7%B3%BB-friendship"><span class="toc-text">⑦ 好友关系 (friendship)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text"> </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E5%BF%B5%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1"><span class="toc-text">二、数据库概念模式设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%B3%BB%E7%BB%9F%E5%88%9D%E6%AD%A5E-R%E5%9B%BE"><span class="toc-text">1. 系统初步E-R图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%B3%BB%E7%BB%9F%E5%9F%BA%E6%9C%ACE-R%E5%9B%BE"><span class="toc-text">2. 系统基本E-R图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%BB%E8%BE%91%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1"><span class="toc-text">三、数据库逻辑模式设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%BC%8F"><span class="toc-text">1. 数据库关系模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%BC%8F%E8%8C%83%E5%BC%8F%E7%AD%89%E7%BA%A7%E7%9A%84%E5%88%A4%E5%AE%9A%E4%B8%8E%E8%A7%84%E8%8C%83%E5%8C%96"><span class="toc-text">2. 关系模式范式等级的判定与规范化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96"><span class="toc-text">3. 数据库设计优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0%E8%AE%BE%E8%AE%A1"><span class="toc-text">四、系统实现设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%80%BB%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-text">4.1 总体架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%A9%E7%90%86%E8%AE%BE%E8%AE%A1"><span class="toc-text">4.2 数据库物理设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-%E5%AD%98%E5%8F%96%E6%96%B9%E6%B3%95"><span class="toc-text">4.2.1 存取方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-%E7%B4%A2%E5%BC%95%E5%AE%9A%E4%B9%89"><span class="toc-text">4.2.2 索引定义</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%E8%AE%BE%E8%AE%A1"><span class="toc-text">4.3 后端实现设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-text">4.3.1 技术选型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87%EF%BC%88%E5%9F%BA%E4%BA%8E%E7%8E%B0%E6%9C%89%E4%BB%93%E5%BA%93%EF%BC%89"><span class="toc-text">4.3.2 代码组织（基于现有仓库）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%9D%83%E9%99%90"><span class="toc-text">4.3.3 认证与权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8E%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1"><span class="toc-text">4.3.4 文件上传与静态服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-5-%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E8%BF%81%E7%A7%BB"><span class="toc-text">4.3.5 数据一致性与迁移</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-6-%E6%97%A5%E5%BF%97%E4%B8%8E%E5%AE%A1%E8%AE%A1"><span class="toc-text">4.3.6 日志与审计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-7-%E5%B8%B8%E7%94%A8-API-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-text">4.3.7 常用 API 设计原则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0%E8%AE%BE%E8%AE%A1"><span class="toc-text">4.4 前端实现设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B8%8E%E7%BB%93%E6%9E%84"><span class="toc-text">4.4.1 技术栈与结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87%EF%BC%88%E5%9F%BA%E4%BA%8E%E7%8E%B0%E6%9C%89%E4%BB%93%E5%BA%93%EF%BC%89"><span class="toc-text">4.4.2 代码组织（基于现有仓库）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-3-%E4%BA%A4%E4%BA%92%E4%B8%8E%E5%AE%9E%E6%97%B6%E6%80%A7"><span class="toc-text">4.4.3 交互与实时性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E8%AF%84%E6%B5%8B%E5%BC%95%E6%93%8E"><span class="toc-text">4.5 评测引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-1-%E8%AF%84%E6%B5%8B%E6%B5%81%E7%A8%8B%EF%BC%88%E9%AB%98%E5%B1%82%EF%BC%89"><span class="toc-text">4.5.1 评测流程（高层）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-2-%E6%B2%99%E7%AE%B1%E4%B8%8E%E5%AE%89%E5%85%A8"><span class="toc-text">4.5.2 沙箱与安全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-3-%E5%B9%B6%E5%8F%91%E4%B8%8E%E6%89%A9%E5%B1%95"><span class="toc-text">4.5.3 并发与扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-4-%E9%87%8D%E6%B5%8B%E4%B8%8E%E5%8E%86%E5%8F%B2"><span class="toc-text">4.5.4 重测与历史</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E5%85%B3%E9%94%AE-API-%E5%A5%91%E7%BA%A6"><span class="toc-text">4.6 关键 API 契约</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-1-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97-api-users"><span class="toc-text">4.6.1 用户模块 (&#x2F;api&#x2F;users)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-2-%E9%A2%98%E7%9B%AE%E6%A8%A1%E5%9D%97-api-problems"><span class="toc-text">4.6.2 题目模块 (&#x2F;api&#x2F;problems)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-3-%E6%8F%90%E4%BA%A4%E6%A8%A1%E5%9D%97-api-submissions"><span class="toc-text">4.6.3 提交模块 (&#x2F;api&#x2F;submissions)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-4-%E6%AF%94%E8%B5%9B%E6%A8%A1%E5%9D%97-api-contests"><span class="toc-text">4.6.4 比赛模块 (&#x2F;api&#x2F;contests)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-5-%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9D%97-api-messages"><span class="toc-text">4.6.5 消息模块 (&#x2F;api&#x2F;messages)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-6-%E5%A5%BD%E5%8F%8B%E6%A8%A1%E5%9D%97-api-friendships"><span class="toc-text">4.6.6 好友模块 (&#x2F;api&#x2F;friendships)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-7-%E6%B4%BB%E5%8A%A8%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97-api-activity-logs"><span class="toc-text">4.6.7 活动日志模块 (&#x2F;api&#x2F;activity-logs)</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>系列文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/10/db.html" title="BUAA 2025数据库大作业"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/db/db.webp" onerror="this.onerror=null;this.src='/img/404.webp'" alt="BUAA 2025数据库大作业"></a><div class="content"><a class="title" href="/2026/01/10/db.html" title="BUAA 2025数据库大作业">BUAA 2025数据库大作业</a><time datetime="2026-01-10T07:32:36.000Z" title="创建 2026-01-10 15:32:36">2026-01-10</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最近投稿</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/10/compile.html" title="BUAA 2025编译实验"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/compile/compile.webp" onerror="this.onerror=null;this.src='/img/404.webp'" alt="BUAA 2025编译实验"/></a><div class="content"><a class="title" href="/2026/01/10/compile.html" title="BUAA 2025编译实验">BUAA 2025编译实验</a><time datetime="2026-01-10T07:48:36.000Z" title="创建 2026-01-10 15:48:36">2026-01-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/10/db.html" title="BUAA 2025数据库大作业"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/db/db.webp" onerror="this.onerror=null;this.src='/img/404.webp'" alt="BUAA 2025数据库大作业"/></a><div class="content"><a class="title" href="/2026/01/10/db.html" title="BUAA 2025数据库大作业">BUAA 2025数据库大作业</a><time datetime="2026-01-10T07:32:36.000Z" title="创建 2026-01-10 15:32:36">2026-01-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/20/python.html" title="Python-CUDA-CuDNN-Pytorch-Jupyter配置合集"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/python/python.webp" onerror="this.onerror=null;this.src='/img/404.webp'" alt="Python-CUDA-CuDNN-Pytorch-Jupyter配置合集"/></a><div class="content"><a class="title" href="/2025/08/20/python.html" title="Python-CUDA-CuDNN-Pytorch-Jupyter配置合集">Python-CUDA-CuDNN-Pytorch-Jupyter配置合集</a><time datetime="2025-08-20T05:45:14.000Z" title="创建 2025-08-20 13:45:14">2025-08-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/20/java.html" title="Java多版本环境配置"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/java/java.webp" onerror="this.onerror=null;this.src='/img/404.webp'" alt="Java多版本环境配置"/></a><div class="content"><a class="title" href="/2025/08/20/java.html" title="Java多版本环境配置">Java多版本环境配置</a><time datetime="2025-08-20T03:45:14.000Z" title="创建 2025-08-20 11:45:14">2025-08-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/18/os-shell.html" title="BUAA-OS-shell"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/osshell/osshell.webp" onerror="this.onerror=null;this.src='/img/404.webp'" alt="BUAA-OS-shell"/></a><div class="content"><a class="title" href="/2025/06/18/os-shell.html" title="BUAA-OS-shell">BUAA-OS-shell</a><time datetime="2025-06-17T16:28:25.000Z" title="创建 2025-06-18 00:28:25">2025-06-18</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient( 0deg,#D15FEE,30%,#7D26CD 100%)"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2026 By wrongization</div><div class="footer_custom_text"><a href="https://icp.gov.moe/?keyword=20250929" target="_blank">萌ICP备20250929号</a> <span id="realtime_duration"></span> <p> <a style="margin-inline:5px"target="_blank" href="https://hexo.io/"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"> </a> <a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"> </a> <a style="margin-inline:5px"target="_blank" href="https://github.com/"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"> </a> <a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"> </a> <a style="margin-inline:5px"target="_blank" href="https://www.cloudflare-cn.com"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/DNS-Cloudflare-f6821f?style=flat&logo=cloudflare" title="本站采用Clouldflare DNS" alt="Clouldflare"> </a> <a style="margin-inline:5px"target="_blank" href="https://ipw.cn/ipv6webcheck/?site=wrongization.github.io"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Internet-IPV6-07c160?style=flat&logo=data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjI2NjE2MjI3NDgxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI0NjkiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDY0YTQ0OCA0NDggMCAxIDAgMCA4OTZBNDQ4IDQ0OCAwIDAgMCA1MTIgNjR6IG0wIDgyMC4wMzJBMzcyLjAzMiAzNzIuMDMyIDAgMCAxIDUxMiAxMzkuOTY4YTM3Mi4wMzIgMzcyLjAzMiAwIDAgMSAwIDc0NC4wNjR6IiBmaWxsPSIjMDdjMTYwIiBwLWlkPSIyNDcwIj48L3BhdGg+PHBhdGggZD0iTTM4Mi4yMDggNzMxLjI2NFYzMjBIMzIwdjQxMS4yNjRoNjIuMjA4eiBtMTQ0LjU3NiAwVjU3MS4xMzZoMTA2LjU2Yzk4LjQ5NiAwIDE0OC4wMzItNDIuMDQ4IDE0OC4wMzItMTI2LjE0NEM3ODEuMzc2IDM2MS40NzIgNzMyLjQxNiAzMjAgNjM0LjQ5NiAzMjBINDY0djQxMS4yNjRoNjIuNzg0eiBtMTAyLjUyOC0yMTMuNjk2SDUyNi43ODR2LTE0NGgxMDIuNTI4YzMwLjUyOCAwIDUyLjk5MiA1Ljc2IDY3LjM5MiAxNy4yOCAxNC40IDEwLjM2OCAyMS44ODggMjguOCAyMS44ODggNTQuMTQ0IDAgMjUuMzQ0LTcuNDg4IDQzLjc3Ni0yMS4zMTIgNTUuMjk2LTE0LjQgMTEuNTItMzYuODY0IDE3LjI4LTY3Ljk2OCAxNy4yOHoiIGZpbGw9IiMwN2MxNjAiIHAtaWQ9IjI0NzEiPjwvcGF0aD48L3N2Zz4=" title="本站支持IPv6访问" alt="ipv6"> </a> <a style="margin-inline:5px"target="_blank" href="https://v6.51.la/land/3L1PzYyEGNZiFQyL"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Support-51.LA-1690ff?style=flat&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAAzNJREFUWEe9V0tPFEEQ5j+BC8h7kaiJB72oUS/Gg3pRSYw3PRkvHky8EpC3LNGoG4yKxIgxRPEgvjBBWUIEI+oShekZdmd2y/qGGXeYbmZndnUr+fbVPVVfV39V3VvVOig+x0fMNL9XFPGRbLptUMxX8ct6x22i9oRVUSBm25DQkIE0fuAvFUV7wiRe/GpZBFoZLYPqsWL4JwQQPD68SUQ1HoSyCdT1adQ5YdC16QzV9mrKOUEoiwBWHLuh0cSCST9EnnbdFNQUcSvKIrCzX9DBOzppWbLt4uQG1TAh1dztUBaBag7WNeNEZ3u5bFFDvxZJkCUTaBwQtGdE0NJazglPZPHHUw+NSFoomUBNj6DLzzec0AVLfjJpB2cmbEWURKCZU9zMGZhZsZywBVvL5G1dQB+qZ/0oiUCMU3z2sUF5J6jfumYyocUYmUALA3s8njKdcLJ9+Z2j3awP6ETlw4vIBOr7BB1N6qRvH9826AM6UfnwIjIBpHbgfaH0trPXrA/oBHpR+XERiUAjC2vfqKAVTd79rE+PmHFm3LD1ovLlIhIBNJ6rLzKbETw2tWTR8Ac5K4/mTVsvQSUZmgBSCUezPwuNxzW04P23dDJ8uoBOoJf6gJIMTQDN5cITufEsr+VtxSM7OJT81v8uG1iSoQig9Or52J1clBtP95vNANjrTkVv+MZ6gW6gH5XvUATqegUdH9Mloa1z1zvkdD23O779LpOEbpAhle+iBLDvSP/oR1lkY9z3cR9wRYa6vzIlbxN0w/6VJVmUQAOv7gALLK1vTa7FX0/7Tj50vr0JQcvrcpmeZ/1gIV7fQFEC1T0aXX8ll970V4v3VT77oYduzx3BtaeLpq0j6Mk7P5AAUtbB16yFX3LpXXqmvv1AD4fv4pbkyxi7OHHf4Dvk1vmBBGIsPgSC5dgfkGfMpXM2MdX9D3qI8UqTc6ZdEZgPwBKzWd4ynuN5LpBAE+/psXu6fetFWwXOcakd4d8w5p3rBcbQmFCWmI+jGz5OPjDs8dAE4gw4q+W0IXUuIEzvPD9Uz2HlqktKURH+b/wlwC/On1OzovD8OdVSnIFVsKkkmMRq25BI/QEyZCI2oNn1NQAAAABJRU5ErkJggg==" title="本站采用51.LA统计" alt="51.LA"> </a> </p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"></div><div id="rightside-config-show"><button id="darkmode" type="button" title="打开/关闭夜间模式"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="隐藏/显示侧边栏"><i class="fas fa-arrows-alt-h"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="go-up" type="button" title="返回顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3L1PzYyEGNZiFQyL",ck:"3L1PzYyEGNZiFQyL"})</script><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script> new LingQue.Monitor().init({id:"3L1Q2CzO5ktWU3Sd"});</script><script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.7/dayjs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.7/plugin/duration.min.js"></script><script src="/scripts/realtime.js"></script><linkrel="stylesheet"href="http://aciano.top/redirect/?target=https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css"><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.6" zIndex="-1" count="60" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="ZTMY" data-fontsize="15px" data-random="false" async="async"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>